<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cyberpunk RPG Clicker - Edição Vue</title>
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- Day.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');
        
        html, body {
            height: 100%;
            overflow: hidden;
            background-color: #0d0208;
        }
        body {
            font-family: 'Roboto', sans-serif;
            color: #e0e0e0;
        }
        .font-pixel { font-family: 'Press Start 2P', cursive; }
        
        :root {
            --highlight-color: #00ffff;
            --xp-color: #ff00ff;
            --gold-color: #ffd700;
            --skill-color: #39ff14;
            --prestige-color: #f77fbe;
            --achievement-color: #ffdf00;
            --health-color: #ff4d4d;
            --crit-color: #ff9900;
            --rarity-comum: #ffffff;
            --rarity-incomum: #1eff00;
            --rarity-raro: #0070dd;
            --rarity-lendario: #a335ee;
        }

        @keyframes floatUp {
            to { opacity: 0; transform: translateY(-80px); }
        }
        .floating-text { animation: floatUp 1.5s ease-out forwards; }

        @keyframes toastInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .toast { animation: toastInRight 0.5s ease-out forwards; }

        .skill-node { position: relative; }
        .skill-node.locked { filter: grayscale(80%) brightness(50%); }
        .skill-connector { position: absolute; width: 50%; height: 2px; background-color: #4a5568; top: 50%; left: 100%; transform: translateY(-50%); }
        
        .fullscreen-content::-webkit-scrollbar { width: 8px; }
        .fullscreen-content::-webkit-scrollbar-track { background: #1a1a1a; }
        .fullscreen-content::-webkit-scrollbar-thumb { background-color: var(--highlight-color); border-radius: 10px; border: 2px solid #1a1a1a; }

        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body class="bg-[#0d0208] text-gray-200">

    <div id="app">
        <!-- Barra Superior de Recursos e Habilidades -->
        <div class="w-full bg-[#1a1a1a]/80 backdrop-blur-sm border-b border-gray-700 p-2 z-30 flex-shrink-0">
            <div class="max-w-7xl mx-auto flex justify-between items-center">
                <!-- Recursos -->
                <div class="flex flex-wrap items-center gap-x-4 gap-y-1 font-pixel text-xs sm:text-sm">
                    <p class="text-yellow-400" title="Creds"><i class="fas fa-coins"></i> {{ formatNumber(gameState.creds) }}</p>
                    <p class="text-fuchsia-400" title="Experiência"><i class="fas fa-star"></i> {{ formatNumber(gameState.xp) }}</p>
                    <div class="flex items-center gap-2 text-red-500" title="Vida">
                        <i class="fas fa-heart"></i>
                        <span>{{ formatNumber(gameState.health) }} / {{ formatNumber(computedStats.maxHealth) }}</span>
                    </div>
                </div>
                <!-- Habilidades Ativas -->
                <div class="flex gap-2">
                    <button v-for="skill in activeSkills" :key="skill.id" @click="activateSkill(skill.id)" :disabled="skill.onCooldown" class="w-10 h-10 sm:w-12 sm:h-12 bg-gray-800 border-2 rounded-lg relative overflow-hidden transition-all disabled:grayscale disabled:cursor-not-allowed" :class="skill.onCooldown ? 'border-gray-600' : 'border-green-400 hover:bg-gray-700'" :title="`${skill.name}\n${skill.description}`">
                        <i :class="['fa-solid', skill.icon, 'text-lg sm:text-xl']" :style="{color: skill.onCooldown ? '#666' : 'var(--skill-color)'}"></i>
                        <div v-if="skill.onCooldown" class="absolute inset-0 bg-black/70 flex items-center justify-center font-pixel text-xs sm:text-sm text-white">
                            {{ skill.cooldownLeft }}
                        </div>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Barra de Evento Aleatório -->
        <div v-if="activeEvent" class="w-full bg-gradient-to-r from-fuchsia-500 to-cyan-500 text-black p-2 text-center font-pixel text-sm animate__animated animate__fadeInDown">
            <i :class="['fa-solid', activeEvent.icon, 'mr-2']"></i>
            <span>{{ activeEvent.description }} ({{ activeEventTimer }}s restantes)</span>
        </div>

        <!-- Área de Ação Principal -->
        <main class="flex-grow flex items-center justify-center p-4">
            <div ref="actionPanelRef" class="relative bg-[#1a1a1a] p-6 rounded-xl border border-gray-700 text-center flex flex-col items-center justify-center w-full max-w-2xl min-h-[300px] sm:min-h-[400px]">
                <div v-if="isPlayerDefeated" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-10 animate__animated animate__fadeIn">
                    <h2 class="font-pixel text-3xl text-red-500">VOCÊ FOI DERROTADO</h2>
                    <p class="text-lg mt-2">Recuperando em {{ playerDefeatedTimer }}s...</p>
                </div>
                <h2 class="font-pixel text-xl sm:text-2xl mb-2">Alvo: {{ currentEnemy.name }}</h2>
                <p class="text-sm font-pixel mb-4">ATK: {{formatNumber(currentEnemy.attack)}} / DEF: {{formatNumber(currentEnemy.defense)}}</p>
                
                <button @click="manualClick" :disabled="isPlayerDefeated" class="transition-transform active:scale-95 disabled:opacity-50">
                    <i :class="['fa-solid', currentEnemy.icon, 'text-7xl sm:text-8xl md:text-9xl']" :style="{ color: currentEnemy.color, filter: `drop-shadow(0 0 15px ${currentEnemy.color})` }"></i>
                </button>

                <div class="w-3/4 mt-4 text-center">
                    <p class="font-pixel text-sm text-cyan-400 mb-2">Ciclo de Combate</p>
                    <div class="w-full bg-gray-800 rounded-full h-5 overflow-hidden border-2 border-cyan-500/50">
                        <div class="bg-cyan-400 h-full rounded-full transition-all duration-100 ease-linear" :style="{ width: `${combatProgress}%` }"></div>
                    </div>
                </div>
                
                <div v-if="gameState.comboCount > 1 || gameState.comboBonusActive" class="font-pixel text-lg mt-2 animate__animated animate__pulse" :style="{color: 'var(--crit-color)'}">
                    <span v-if="gameState.comboBonusActive">BÔNUS DE COMBO! ({{ gameState.comboBonusRoundsLeft }} rodadas)</span>
                    <span v-else>COMBO x{{ gameState.comboCount }}</span>
                </div>

                <button @click="openView('enemySelection')" class="font-pixel text-xs py-2 px-4 mt-4 rounded-md bg-gray-600 text-white hover:bg-gray-500 transition">Mudar Alvo</button>
                
                <div v-for="text in floatingTexts" :key="text.id" class="floating-text absolute font-pixel text-2xl pointer-events-none" :style="{ top: text.y + 'px', left: text.x + 'px', color: text.color }">
                    {{ text.content }}
                </div>
            </div>
        </main>
        
        <!-- Botão Flutuante (FAB) e Menu -->
        <div class="fixed bottom-6 right-6 z-40">
            <transition name="menu-fade">
                <div v-if="isMenuOpen" class="flex flex-col items-center gap-3 mb-3">
                    <button v-for="tab in shopTabs" :key="tab.id" @click="openView(tab.id)" class="w-14 h-14 rounded-full bg-cyan-400 text-black flex items-center justify-center shadow-lg hover:bg-cyan-300 transition-transform hover:scale-110" :title="tab.name">
                        <i :class="['fa-solid', tab.icon, 'text-2xl']"></i>
                    </button>
                </div>
            </transition>
            <button @click="toggleMenu" class="w-16 h-16 rounded-full bg-fuchsia-500 text-white flex items-center justify-center shadow-lg hover:bg-fuchsia-400 transition-transform" :class="isMenuOpen ? 'rotate-45' : ''">
                <i class="fa-solid fa-plus text-3xl"></i>
            </button>
        </div>

        <!-- Painel de Visão em Tela Cheia -->
        <div v-if="activeView" class="fixed inset-0 bg-[#0d0208]/95 backdrop-blur-sm z-50 flex flex-col p-4 animate__animated animate__fadeIn" @click.self="closeView">
            <div class="bg-[#1a1a1a] border border-gray-700 rounded-xl flex flex-col h-full max-h-full">
                <!-- Cabeçalho da Visão -->
                <div class="flex justify-between items-center p-4 border-b border-gray-700 flex-shrink-0">
                    <h2 class="font-pixel text-xl text-cyan-400"><i :class="['fa-solid', currentViewIcon, 'mr-3']"></i>{{ currentViewName }}</h2>
                    <button @click="closeView" class="text-gray-400 hover:text-white text-4xl leading-none transition">&times;</button>
                </div>
                <!-- Conteúdo Rolável -->
                <div class="p-6 flex-grow overflow-y-auto fullscreen-content space-y-6">
                    <!-- Seleção de Inimigo -->
                    <div v-if="activeView === 'enemySelection'">
                        <div v-for="enemy in enemyData" :key="enemy.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg mb-2">
                            <div>
                                <p class="font-bold"><i :class="['fa-solid', enemy.icon, 'mr-2']" :style="{color: enemy.color}"></i>{{ enemy.name }} (Nível {{ enemy.level }})</p>
                                <p class="text-sm text-gray-400">ATK: {{ formatNumber(enemy.attack) }} | DEF: {{ formatNumber(enemy.defense) }}</p>
                            </div>
                            <button @click="selectEnemy(enemy.id)" :disabled="gameState.currentEnemyId === enemy.id" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">
                                {{ gameState.currentEnemyId === enemy.id ? 'Lutando' : 'Lutar' }}
                            </button>
                        </div>
                    </div>
                    <!-- Personagem -->
                    <div v-if="activeView === 'character'">
                         <div class="bg-[#1a1a1a] p-6 rounded-xl border border-gray-700 shadow-lg shadow-cyan-500/10">
                            <div class="text-center mb-4">
                                <h1 class="font-pixel text-2xl text-white">Mercenário</h1>
                                <h2 class="font-pixel text-cyan-400">Nível {{ gameState.level }}</h2>
                            </div>

                            <div class="flex justify-center gap-4 mb-4 p-2 bg-gray-800 rounded-lg">
                                <div v-for="(itemId, type) in gameState.equipment" :key="type" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl text-gray-500" :title="getItem(type, itemId)?.name || 'Vazio'">
                                    <i v-if="getItem(type, itemId)" :class="['fa-solid', getItem(type, itemId).icon, 'text-cyan-400']"></i>
                                    <i v-else class="fa-solid fa-question"></i>
                                </div>
                            </div>

                            <div>
                                <div class="bg-gray-800 rounded-full h-4 overflow-hidden">
                                    <div class="bg-fuchsia-500 h-4 transition-all duration-300" :style="{ width: `${(gameState.xp / gameState.xpToNextLevel) * 100}%` }"></div>
                                </div>
                                <p class="text-center text-sm mt-1 text-gray-400">{{ formatNumber(gameState.xp) }} / {{ formatNumber(gameState.xpToNextLevel) }} XP</p>
                            </div>

                            <div v-for="(items, title) in { 'Atributos': gameState.attributes, 'Estatísticas': computedStats }" :key="title" class="mt-6">
                                <h3 class="font-pixel text-cyan-400 text-sm mb-2">{{ title }}</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <div v-for="(value, key) in items" :key="key" class="bg-gray-800 p-2 rounded-lg text-center">
                                        <p class="text-xs capitalize text-gray-400">{{ {attack: 'Ataque', defense: 'Defesa', credsPerClick: 'Creds / Clique', credsPerSecond: 'Creds / Seg', xpMultiplier: 'Bônus de XP', critChance: 'Chance Crítica', critDamageMultiplier: 'Dano Crítico', prestigeBonus: 'Bônus de Prestígio', achievementBonus: 'Bônus de Conquista', maxHealth: 'Vida Máxima'}[key] || key.replace(/([A-Z])/g, ' $1') }}</p>
                                        <p class="font-pixel text-lg" :class="{'text-pink-400': key === 'prestigeBonus', 'text-yellow-400': key === 'achievementBonus', 'text-cyan-400': !['prestigeBonus', 'achievementBonus'].includes(key)}">
                                            {{ (key.includes('Bonus') || key.includes('Multiplier') ? `+${formatNumber((value - 1) * 100, 2)}%` : (key.includes('Chance') ? `${formatNumber(value * 100, 2)}%` : formatNumber(value))) }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Equipamentos -->
                    <div v-if="activeView === 'equipment'">
                        <div v-for="(items, type) in gameState.inventory" :key="type" class="mb-6">
                            <h3 class="font-pixel text-cyan-400 capitalize">{{ {arma: 'Armas', armadura: 'Armaduras', implante: 'Implantes'}[type] || type }}</h3>
                            <div class="space-y-2 mt-2">
                                <div v-for="item in items" :key="item.uniqueId" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                    <div>
                                        <p class="font-bold" :style="{color: item.rarityColor}"><i :class="['fa-solid', item.icon, 'mr-2']"></i>{{ item.name }}</p>
                                        <p class="text-sm text-gray-400">+{{ item.bonus.value }} {{ {attack: 'Ataque', defense: 'Defesa', forca: 'Força', destreza: 'Destreza'}[item.bonus.stat] || item.bonus.stat }}</p>
                                    </div>
                                    <button v-if="gameState.equipment[type] === item.uniqueId" class="font-pixel text-xs py-2 px-3 rounded-md bg-gray-600" disabled>Equipado</button>
                                    <button v-else @click="equipItem(type, item.uniqueId)" class="font-pixel text-xs py-2 px-3 rounded-md bg-yellow-500 text-black hover:bg-yellow-400 transition">Equipar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Agentes -->
                    <div v-if="activeView === 'agents'" class="space-y-2">
                         <div v-for="agent in agentsData" :key="agent.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold"><i :class="['fa-solid', agent.icon, 'mr-2']"></i>{{ agent.name }} ({{ gameState.agents[agent.id] || 0 }})</p>
                                <p class="text-sm text-gray-400">+{{ formatNumber(agent.cps, 2) }} Creds/s</p>
                            </div>
                            <button @click="buyAgent(agent.id)" :disabled="gameState.creds < getAgentCost(agent.id)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getAgentCost(agent.id)) }} Creds</button>
                         </div>
                    </div>
                    <!-- Treinamento -->
                    <div v-if="activeView === 'training'" class="space-y-2">
                        <div v-for="(value, attr) in gameState.attributes" :key="attr" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <p class="font-bold capitalize">Treinar {{ {forca: 'Força', destreza: 'Destreza', vigor: 'Vigor'}[attr] || attr }}</p>
                            <button @click="trainAttribute(attr)" :disabled="gameState.creds < getTrainCost(attr)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getTrainCost(attr)) }} Creds</button>
                        </div>
                        <hr class="border-gray-700 my-4">
                        <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold capitalize">Aprimorar Velocidade de Combate</p>
                                <p class="text-sm text-gray-400">Velocidade atual: Nível {{ formatNumber(gameState.combatSpeedLevel) }}</p>
                            </div>
                            <button @click="upgradeCombatSpeed" :disabled="gameState.creds < getCombatSpeedUpgradeCost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getCombatSpeedUpgradeCost) }} Creds</button>
                        </div>
                        <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold capitalize">Aprimorar Chance Crítica</p>
                                <p class="text-sm text-gray-400">Chance atual: {{ formatNumber(computedStats.critChance * 100, 2) }}%</p>
                            </div>
                            <button @click="upgradeCritChance" :disabled="gameState.creds < getCritChanceUpgradeCost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getCritChanceUpgradeCost) }} Creds</button>
                        </div>
                        <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold capitalize">Aprimorar Dano Crítico</p>
                                <p class="text-sm text-gray-400">Dano atual: +{{ formatNumber((computedStats.critDamageMultiplier - 1) * 100) }}%</p>
                            </div>
                            <button @click="upgradeCritDamage" :disabled="gameState.creds < getCritDamageUpgradeCost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getCritDamageUpgradeCost) }} Creds</button>
                        </div>
                         <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold capitalize">Aprimorar Duração do Combo</p>
                                <p class="text-sm text-gray-400">Rodadas de Bônus: {{ formatNumber(computedStats.comboRounds) }}</p>
                            </div>
                            <button @click="upgradeComboDuration" :disabled="gameState.creds < getComboDurationUpgradeCost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getComboDurationUpgradeCost) }} Creds</button>
                        </div>
                    </div>
                    <!-- Habilidades -->
                     <div v-if="activeView === 'skills'" class="space-y-4">
                        <h3 class="font-pixel text-cyan-400">Árvore de Habilidades Passivas</h3>
                        <div class="flex flex-col md:flex-row gap-8 items-center md:items-start overflow-x-auto pb-4">
                            <div v-for="skill in skillTree" :key="skill.id" class="flex items-center flex-shrink-0">
                                <div class="flex flex-col items-center">
                                    <div class="skill-node bg-gray-800 p-3 rounded-lg flex flex-col items-center text-center w-48" :class="{ locked: !skill.unlocked }">
                                        <p class="font-bold"><i class="fa-solid fa-star mr-2"></i>{{ skill.name }} ({{ skill.level }}/{{ skill.maxLevel }})</p>
                                        <p class="text-xs text-gray-400 my-2 h-10">{{ skill.description }}</p>
                                        <button @click="buySkill('passive', skill.id)" :disabled="!skill.canBuy" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-green-500 text-black hover:bg-green-400 transition disabled:bg-gray-700 disabled:text-gray-400 disabled:cursor-not-allowed">{{ skill.buttonText }}</button>
                                        <div v-if="skill.requires" class="skill-connector"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-700 my-6">
                        <h3 class="font-pixel text-cyan-400">Comprar Habilidades Ativas</h3>
                         <div v-for="skill in skillsData.active.filter(s => !gameState.skills.active[s.id])" :key="skill.id">
                             <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                 <div>
                                     <p class="font-bold"><i :class="['fa-solid', skill.icon, 'mr-2']"></i>{{ skill.name }}</p>
                                     <p class="text-sm text-gray-400">{{ skill.description }}</p>
                                 </div>
                                 <button @click="buySkill('active', skill.id)" :disabled="gameState.creds < skill.cost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(skill.cost) }} Creds</button>
                             </div>
                         </div>
                    </div>
                    <!-- Contratos -->
                    <div v-if="activeView === 'contracts'">
                        <div v-if="activeContract" class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="font-pixel text-cyan-400">{{ activeContract.name }}</h3>
                            <p class="text-sm text-gray-400 my-2">{{ activeContract.description }}</p>
                            <div class="w-full bg-gray-900 rounded-full h-2.5">
                                <div class="bg-green-500 h-2.5 rounded-full" :style="{width: contractProgress.percentage + '%'}"></div>
                            </div>
                            <p class="text-center text-sm mt-1">{{ contractProgress.text }}</p>
                            <div class="mt-4 flex gap-4">
                                <button v-if="isContractComplete" @click="claimReward" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-green-500 text-black hover:bg-green-400 transition">Coletar Recompensa</button>
                                <button v-else @click="cancelContract" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Cancelar</button>
                            </div>
                        </div>
                        <div v-else class="space-y-2">
                            <p class="text-center text-gray-400 mb-4">Nenhum contrato ativo. Escolha um abaixo.</p>
                            <div v-for="contract in availableContracts" :key="contract.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                <div>
                                    <p class="font-bold">{{ contract.name }}</p>
                                    <p class="text-sm text-gray-400">Recompensa: {{ formatNumber(contract.reward.value) }} {{ contract.reward.type === 'creds' ? 'Creds' : 'PH' }}</p>
                                </div>
                                <button @click="acceptContract(contract.id)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition">Aceitar</button>
                            </div>
                             <p v-if="!availableContracts.length" class="text-center text-gray-500">Nenhum contrato disponível no momento. Volte mais tarde.</p>
                        </div>
                    </div>
                    <!-- Conquistas -->
                    <div v-if="activeView === 'achievements'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="achievement in achievementsData" :key="achievement.id" class="bg-gray-800 p-3 rounded-lg flex items-center gap-4" :class="{'opacity-50': !isAchievementCompleted(achievement.id)}">
                            <i class="fa-solid fa-trophy text-3xl" :class="isAchievementCompleted(achievement.id) ? 'text-yellow-400' : 'text-gray-600'"></i>
                            <div>
                                <p class="font-bold">{{ achievement.name }}</p>
                                <p class="text-xs text-gray-400">{{ achievement.description }}</p>
                                <p v-if="isAchievementCompleted(achievement.id)" class="text-xs text-green-400 font-bold">Bônus: {{ achievement.bonus.description }}</p>
                            </div>
                        </div>
                    </div>
                    <!-- Sistema -->
                    <div v-if="activeView === 'system'">
                        <div class="flex flex-col gap-4 mt-4">
                            <button @click="saveGame(true)" class="font-pixel text-sm py-3 px-4 rounded-md bg-cyan-500 text-black hover:bg-cyan-400 transition">Salvar Manualmente</button>
                            <button @click="askForConfirmation('Resetar Jogo', 'Você tem certeza que quer apagar todo o progresso? Esta ação não pode ser desfeita.', resetGame)" class="font-pixel text-sm py-3 px-4 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Resetar Jogo</button>
                            <button v-if="gameState.level >= PRESTIGE_LEVEL_REQ" @click="askForConfirmation('Prestigiar', `Você tem certeza? Seu progresso será resetado, mas você ganhará ${prestigePointsToGain} Fragmentos de IA como bônus permanente.`, prestigeReset)" class="font-pixel text-sm py-3 px-4 rounded-md bg-gradient-to-r from-pink-500 to-fuchsia-500 text-white hover:opacity-90 transition">Prestigiar (+{{ prestigePointsToGain }} Fragmentos)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modals -->
        <div v-if="showOfflineModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate__animated animate__fadeIn">
            <div class="bg-[#1a1a1a] p-8 rounded-xl border-2 border-cyan-400 text-center max-w-sm w-full animate__animated animate__zoomIn">
                <h2 class="font-pixel text-2xl text-cyan-400">Bem-vindo de volta!</h2>
                <p class="my-4 text-lg">Enquanto esteve fora, seus agentes mineraram:</p>
                <p class="font-pixel text-2xl text-yellow-400">{{ formatNumber(offlineGains) }} Creds</p>
                <button @click="showOfflineModal = false" class="mt-6 font-pixel text-sm py-3 px-6 rounded-md bg-cyan-500 text-black hover:bg-cyan-400 transition">Coletar</button>
            </div>
        </div>
        <div v-if="showConfirmModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate__animated animate__fadeIn">
            <div class="bg-[#1a1a1a] p-8 rounded-xl border-2 border-red-500 text-center max-w-sm w-full animate__animated animate__zoomIn">
                <h2 class="font-pixel text-2xl text-red-500">{{ confirmTitle }}</h2>
                <p class="my-4 text-lg">{{ confirmMessage }}</p>
                <div class="flex justify-center gap-4 mt-6">
                    <button @click="cancelConfirm" class="font-pixel text-sm py-3 px-6 rounded-md bg-gray-600 text-white hover:bg-gray-500 transition">Cancelar</button>
                    <button @click="handleConfirm" class="font-pixel text-sm py-3 px-6 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Confirmar</button>
                </div>
            </div>
        </div>
        <div v-if="toast.show" class="toast fixed bottom-5 right-5 bg-cyan-500 text-black font-pixel text-sm p-4 rounded-lg shadow-lg z-50" :style="{backgroundColor: toast.color || 'var(--highlight-color)'}">
            <i :class="['fa-solid', toast.icon, 'mr-2']"></i>{{ toast.message }}
        </div>
    </div>

    <script type="module">
        const { createApp, ref, reactive, computed, onMounted, onUnmounted, watch } = Vue;

        const appLogic = {
            setup() {
                // --- GAME DATA (Constants) ---
                const PRESTIGE_LEVEL_REQ = 50;
                const equipmentData = {
                    arma: [ { id: 'w1', name: 'Pistola Básica', cost: 50, icon: 'fa-gun', bonus: { stat: 'attack', value: 2 } }, { id: 'w2', name: 'Submetralhadora', cost: 250, icon: 'fa-dragon', bonus: { stat: 'attack', value: 10 } }, { id: 'w3', name: 'Rifle de Precisão', cost: 1200, icon: 'fa-bullseye', bonus: { stat: 'attack', value: 40 } }, { id: 'w4', name: 'Railgun', cost: 8000, icon: 'fa-bolt-lightning', bonus: { stat: 'attack', value: 150 } } ],
                    armadura: [ { id: 'a1', name: 'Jaqueta Reforçada', cost: 75, icon: 'fa-shirt', bonus: { stat: 'defense', value: 5 } }, { id: 'a2', name: 'Colete de Kevlar', cost: 300, icon: 'fa-user-shield', bonus: { stat: 'defense', value: 20 } }, { id: 'a3', name: 'Placas de Titânio', cost: 1500, icon: 'fa-shield-halved', bonus: { stat: 'defense', value: 80 } }, { id: 'a4', name: 'Exo-traje de Combate', cost: 10000, icon: 'fa-user-astronaut', bonus: { stat: 'defense', value: 300 } } ],
                    implante: [ { id: 'i1', name: 'Olho Cibernético', cost: 500, icon: 'fa-eye', bonus: { stat: 'destreza', value: 5 } }, { id: 'i2', name: 'Braço Hidráulico', cost: 800, icon: 'fa-robot', bonus: { stat: 'forca', value: 8 } }, { id: 'i3', name: 'Link Neural Avançado', cost: 12000, icon: 'fa-brain', bonus: { stat: 'destreza', value: 25 } } ]
                };
                const agentsData = [ { id: 'ag1', name: 'Drone de Mineração', cost: 1000, icon: 'fa-helicopter', cps: 0.5 }, { id: 'ag2', name: 'Bot de Trading', cost: 5000, icon: 'fa-chart-line', cps: 3 }, { id: 'ag3', name: 'IA de Investimento', cost: 25000, icon: 'fa-brain', cps: 15 } ];
                const enemyData = reactive([ 
                    { id: 'e1', level: 1, name: 'Drone de Segurança', icon: 'fa-crosshairs', color: '#f04a4a', defense: 10, attack: 5, reward: { xp: 10, creds: 5 } }, 
                    { id: 'e2', level: 5, name: 'Guarda Corporativo', icon: 'fa-user-shield', color: '#f0a04a', defense: 50, attack: 20, reward: { xp: 50, creds: 25 } }, 
                    { id: 'e3', level: 10, name: 'Mecha de Patrulha', icon: 'fa-robot', color: '#e0e0e0', defense: 200, attack: 50, reward: { xp: 200, creds: 100 } }, 
                    { id: 'e4', level: 20, name: 'Netrunner Inimigo', icon: 'fa-user-secret', color: '#ff00ff', defense: 500, attack: 120, reward: { xp: 750, creds: 400 } },
                    { id: 'e5', level: 30, name: 'Cyborg Assassino', icon: 'fa-skull-crossbones', color: '#9d4edd', defense: 2000, attack: 300, reward: { xp: 3000, creds: 1500 } },
                    { id: 'e6', level: 40, name: 'Mecha Pesado', icon: 'fa-jet-fighter', color: '#ff5c5c', defense: 8000, attack: 600, reward: { xp: 10000, creds: 5000 } }
                ]);
                const skillsData = {
                    passive: [ { id: 'p1', name: 'Protocolo de Eficiência', maxLevel: 5, cost: 1, description: 'Aumenta o ganho de XP em 5% por nível.', bonus: { stat: 'xpMultiplier', value: 0.05 }, requires: null }, { id: 'p2', name: 'Conexão Neural', maxLevel: 5, cost: 1, description: 'Aumenta a chance de drop de créditos em 2% por nível.', bonus: { stat: 'critCredChance', value: 0.02 }, requires: 'p1' }, { id: 'p3', name: 'Otimização de Rota', maxLevel: 10, cost: 2, description: 'Aumenta o ganho de Creds/s em 10% por nível.', bonus: { stat: 'cpsMultiplier', value: 0.10 }, requires: 'p2' } ],
                    active: [ { id: 'ac1', name: 'Overdrive', cost: 2500, icon: 'fa-bolt', description: 'Aumenta o ataque em 200% por 10s.', cooldown: 60, duration: 10, effect: { type: 'multiplier', stat: 'attack', value: 2 } }, { id: 'ac2', name: 'Hack de Créditos', cost: 5000, icon: 'fa-sack-dollar', description: 'Gera instantaneamente o equivalente a 30 segundos de ganhos.', cooldown: 120, effect: { type: 'instant', stat: 'creds', value: 30 } }, { id: 'ac3', name: 'Pulso EMP', cost: 15000, icon: 'fa-burst', description: 'Gera instantaneamente o equivalente a 5 minutos de ganhos.', cooldown: 300, effect: { type: 'instant', stat: 'creds', value: 300 } } ]
                };
                const contractsData = [ { id: 'c1', name: 'Exterminar Drones', description: 'Derrube Drones de Segurança para coletar seus componentes.', type: 'kill', target: 'e1', targetCount: 50, minLevel: 1, reward: { type: 'creds', value: 2500 } }, { id: 'c2', name: 'Limpeza Corporativa', description: 'Elimine os Guardas Corporativos que patrulham a área.', type: 'kill', target: 'e2', targetCount: 25, minLevel: 5, reward: { type: 'creds', value: 5000 } }, { id: 'c3', name: 'Primeiros Passos', description: 'Acumule uma pequena fortuna para provar seu valor.', type: 'collect_creds', targetCount: 10000, minLevel: 1, reward: { type: 'skillPoints', value: 1 } }, { id: 'c4', name: 'Caça ao Assassino', description: 'Neutralize o perigoso Cyborg Assassino.', type: 'kill', target: 'e5', targetCount: 10, minLevel: 30, reward: { type: 'skillPoints', value: 5 } } ];
                const achievementsData = [ { id: 'ach1', name: 'Clicador Iniciante', description: 'Clique 100 vezes.', type: 'clicks', target: 100, bonus: { stat: 'globalMultiplier', value: 0.01, description: '+1% de ganhos de Creds' } }, { id: 'ach2', name: 'Mercenário Novato', description: 'Alcance o nível 10.', type: 'level', target: 10, bonus: { stat: 'globalMultiplier', value: 0.02, description: '+2% de ganhos de XP' } }, { id: 'ach3', name: 'Pequeno Investidor', description: 'Acumule 10.000 Creds.', type: 'totalCreds', target: 10000, bonus: { stat: 'globalMultiplier', value: 0.02, description: '+2% de ganhos de Creds' } }, { id: 'ach4', name: 'Veterano das Ruas', description: 'Alcance o nível 25.', type: 'level', target: 25, bonus: { stat: 'xpMultiplier', value: 0.05, description: '+5% de ganhos de XP' } }, ];
                const eventData = [
                    { id: 'evt1', name: 'Surto de Dados', description: 'Ganhos de XP +50%!', icon: 'fa-brain', duration: 90, effect: { stat: 'xpMultiplier', value: 0.5 } },
                    { id: 'evt2', name: 'Mercado em Alta', description: 'Ganhos de Creds +50%!', icon: 'fa-chart-line', duration: 90, effect: { stat: 'credsMultiplier', value: 0.5 } },
                    { id: 'evt3', name: 'Adrenalina de Combate', description: 'Velocidade de Combate +25%!', icon: 'fa-bolt', duration: 90, effect: { stat: 'combatSpeed', value: 0.25 } }
                ];

                // --- GAME STATE (Reactive) ---
                const defaultGameState = () => ({
                    level: 1, xp: 0, xpToNextLevel: 100, creds: 0, skillPoints: 0, prestigePoints: 0,
                    health: 100,
                    lastSaveTimestamp: dayjs().valueOf(),
                    attributes: { forca: 1, destreza: 1, vigor: 1 },
                    equipment: { arma: null, armadura: null, implante: null },
                    inventory: { arma: [], armadura: [], implante: [] },
                    agents: {},
                    skills: { passive: {}, active: {} },
                    activeEffects: {},
                    skillCooldowns: {},
                    activeContractId: null,
                    contractProgress: { collectedCreds: 0 },
                    completedContractIds: [],
                    stats: { totalClicks: 0, totalCreds: 0, enemiesDefeated: {} },
                    completedAchievementIds: [],
                    combatSpeedLevel: 1,
                    critChanceLevel: 1,
                    critDamageLevel: 1,
                    comboDurationLevel: 1,
                    currentEnemyId: 'e1',
                    activeEventId: null,
                    eventEndTime: 0,
                    comboCount: 0,
                    lastClickTimestamp: 0,
                    comboBonusActive: false,
                    comboBonusRoundsLeft: 0,
                    maxComboCount: 0,
                });
                const gameState = reactive(defaultGameState());

                // --- UI STATE ---
                const activeView = ref(null);
                const isMenuOpen = ref(false);
                const shopTabs = [
                    { id: 'character', name: 'Personagem', icon: 'fa-user' },
                    { id: 'equipment', name: 'Equipamentos', icon: 'fa-store' },
                    { id: 'agents', name: 'Agentes', icon: 'fa-users' },
                    { id: 'training', name: 'Treinamento', icon: 'fa-dumbbell' },
                    { id: 'skills', name: 'Habilidades', icon: 'fa-brain' },
                    { id: 'contracts', name: 'Contratos', icon: 'fa-file-signature' },
                    { id: 'achievements', name: 'Conquistas', icon: 'fa-trophy' },
                    { id: 'system', name: 'Sistema', icon: 'fa-cogs' },
                ];
                const floatingTexts = ref([]);
                const actionPanelRef = ref(null);
                const toast = reactive({ show: false, message: '', icon: 'fa-save', color: 'var(--highlight-color)' });
                const showOfflineModal = ref(false);
                const offlineGains = ref(0);
                const showConfirmModal = ref(false);
                const confirmTitle = ref('');
                const confirmMessage = ref('');
                const confirmCallback = ref(null);
                const currentTime = ref(dayjs().valueOf());
                const combatProgress = ref(0);
                const isPlayerDefeated = ref(false);
                const playerDefeatedTimer = ref(0);
                
                // --- COMPUTED PROPERTIES ---
                const activeEvent = computed(() => eventData.find(e => e.id === gameState.activeEventId));
                const activeEventTimer = computed(() => {
                    if (!activeEvent.value) return 0;
                    return Math.max(0, dayjs(gameState.eventEndTime).diff(currentTime.value, 'second'));
                });

                const currentViewName = computed(() => (shopTabs.find(t => t.id === activeView.value) || {name: 'Seleção de Alvo'}).name);
                const currentViewIcon = computed(() => (shopTabs.find(t => t.id === activeView.value) || {icon: 'fa-crosshairs'}).icon);
                
                const getCombatSpeedUpgradeCost = computed(() => Math.floor(50 * Math.pow(1.5, gameState.combatSpeedLevel)));
                const getCritChanceUpgradeCost = computed(() => Math.floor(100 * Math.pow(1.8, gameState.critChanceLevel)));
                const getCritDamageUpgradeCost = computed(() => Math.floor(150 * Math.pow(1.7, gameState.critDamageLevel)));
                const getComboDurationUpgradeCost = computed(() => Math.floor(200 * Math.pow(1.6, gameState.comboDurationLevel)));

                const achievementBonus = computed(() => {
                    const bonuses = { globalMultiplier: 1, xpMultiplier: 1 };
                    gameState.completedAchievementIds.forEach(id => {
                        const achievement = achievementsData.find(a => a.id === id);
                        if (achievement) bonuses[achievement.bonus.stat] = (bonuses[achievement.bonus.stat] || 1) + achievement.bonus.value;
                    });
                    return bonuses;
                });

                const computedStats = computed(() => {
                    const base = gameState.attributes;
                    const eqIds = gameState.equipment;
                    const achBonus = achievementBonus.value;
                    const prestigeBonus = 1 + (gameState.prestigePoints * 0.01);
                    let passiveBonuses = { xpMultiplier: 1, critCredChance: 0, cpsMultiplier: 1 };
                    for (const skillId in gameState.skills.passive) {
                        const skillLevel = gameState.skills.passive[skillId];
                        const skillInfo = skillsData.passive.find(s => s.id === skillId);
                        if (skillInfo) passiveBonuses[skillInfo.bonus.stat] = (passiveBonuses[skillInfo.bonus.stat] || 1) + skillInfo.bonus.value * skillLevel;
                    }
                    const equippedImplante = getItem('implante', eqIds.implante);
                    let currentForca = base.forca + (equippedImplante?.bonus.stat === 'forca' ? equippedImplante.bonus.value : 0);
                    let currentDestreza = base.destreza + (equippedImplante?.bonus.stat === 'destreza' ? equippedImplante.bonus.value : 0);
                    let totalAttack = currentForca * 2 + currentDestreza;
                    let totalDefense = base.vigor * 3;
                    const equippedArma = getItem('arma', eqIds.arma);
                    if (equippedArma) totalAttack += equippedArma.bonus.value;
                    const equippedArmadura = getItem('armadura', eqIds.armadura);
                    if (equippedArmadura) totalDefense += equippedArmadura.bonus.value;
                    
                    if (gameState.activeEffects.overdrive) {
                        const skillInfo = skillsData.active.find(s => s.id === 'ac1');
                        if (skillInfo) {
                            totalAttack *= (1 + skillInfo.effect.value);
                        }
                    }

                    let totalCps = 0;
                    for (const agentId in gameState.agents) {
                        const agentInfo = agentsData.find(a => a.id === agentId);
                        if (agentInfo) totalCps += gameState.agents[agentId] * agentInfo.cps;
                    }

                    let eventBonus = { xpMultiplier: 1, credsMultiplier: 1, combatSpeed: 1 };
                    if (activeEvent.value) {
                        eventBonus[activeEvent.value.effect.stat] = 1 + activeEvent.value.effect.value;
                    }

                    return {
                        attack: totalAttack,
                        defense: totalDefense,
                        maxHealth: 100 + (base.vigor - 1) * 20,
                        credsPerSecond: totalCps * achBonus.globalMultiplier * passiveBonuses.cpsMultiplier,
                        xpMultiplier: passiveBonuses.xpMultiplier * achBonus.xpMultiplier * eventBonus.xpMultiplier,
                        credsMultiplier: eventBonus.credsMultiplier,
                        critChance: 0.05 + (gameState.critChanceLevel - 1) * 0.005, // 5% base + 0.5% per level
                        critDamageMultiplier: 1.5 + (gameState.critDamageLevel - 1) * 0.1, // 150% base + 10% per level
                        prestigeBonus,
                        achievementBonus: achBonus.globalMultiplier,
                        combatSpeed: ((1 + (gameState.combatSpeedLevel - 1) * 0.1) * eventBonus.combatSpeed),
                        comboRounds: 5 + (gameState.comboDurationLevel - 1)
                    };
                });

                const currentEnemy = computed(() => enemyData.find(e => e.id === gameState.currentEnemyId) || enemyData[0]);
                const prestigePointsToGain = computed(() => Math.floor(gameState.level / 20));

                const activeSkills = computed(() => {
                    const now = currentTime.value;
                    return skillsData.active
                        .filter(skill => gameState.skills.active[skill.id])
                        .map(skill => {
                            const cooldownEnd = gameState.skillCooldowns[skill.id] || 0;
                            const onCooldown = cooldownEnd > now;
                            return {
                                ...skill,
                                onCooldown,
                                cooldownLeft: onCooldown ? Math.ceil(dayjs(cooldownEnd).diff(now, 'second', true)) : 0
                            };
                        });
                });
                
                const skillTree = computed(() => {
                    return skillsData.passive.map(skill => {
                        const level = gameState.skills.passive[skill.id] || 0;
                        const isMaxed = level >= skill.maxLevel;
                        const hasRequirement = skill.requires ? (gameState.skills.passive[skill.requires] || 0) > 0 : true;
                        const unlocked = hasRequirement;
                        const canBuy = unlocked && !isMaxed && gameState.skillPoints >= skill.cost;
                        let buttonText = 'BLOQUEADO';
                        if (unlocked) {
                            if (isMaxed) buttonText = 'MÁX';
                            else buttonText = `${skill.cost} PH`;
                        }
                        return { ...skill, level, unlocked, canBuy, buttonText };
                    });
                });

                const activeContract = computed(() => {
                    if (!gameState.activeContractId) return null;
                    return contractsData.find(c => c.id === gameState.activeContractId);
                });
                
                const availableContracts = computed(() => {
                    return contractsData.filter(c => c.minLevel <= gameState.level && !gameState.completedContractIds.includes(c.id));
                });

                const contractProgress = computed(() => {
                    const contract = activeContract.value;
                    if (!contract) return { percentage: 0, text: '' };
                    let current = 0;
                    if (contract.type === 'kill') current = gameState.stats.enemiesDefeated[contract.target] || 0;
                    else if (contract.type === 'collect_creds') current = gameState.contractProgress.collectedCreds || 0;
                    const percentage = Math.min(100, (current / contract.targetCount) * 100);
                    const text = `${formatNumber(current)} / ${formatNumber(contract.targetCount)}`;
                    return { percentage, text };
                });

                const isContractComplete = computed(() => contractProgress.value.percentage >= 100);

                // --- METHODS ---
                const toggleMenu = () => isMenuOpen.value = !isMenuOpen.value;
                const openView = (view) => {
                    activeView.value = view;
                    isMenuOpen.value = false;
                };
                const closeView = () => activeView.value = null;

                const formatNumber = (num, decimals = 0) => {
                    if (num === undefined || num === null || isNaN(num)) return '0';
                    const options = {};
                    if (decimals > 0) {
                        options.minimumFractionDigits = decimals;
                        options.maximumFractionDigits = decimals;
                    }
                    return Math.floor(num).toLocaleString('pt-BR', options);
                }
                const getItem = (type, id) => {
                    if (!id) return null;
                    return gameState.inventory[type].find(i => i.uniqueId === id);
                };
                
                const getAgentCost = (id) => {
                    const agent = agentsData.find(a => a.id === id);
                    if (!agent) return Infinity;
                    return Math.floor(agent.cost * Math.pow(1.15, gameState.agents[id] || 0));
                };
                
                const getTrainCost = (attr) => {
                    return Math.floor(10 * Math.pow(1.2, gameState.attributes[attr]));
                };

                const showFloatingText = (content, color, position) => {
                    if (!actionPanelRef.value) return;
                    const id = Date.now() + Math.random();
                    floatingTexts.value.push({ 
                        id, 
                        content, 
                        color, 
                        x: position.x,
                        y: position.y
                    });
                    setTimeout(() => {
                        floatingTexts.value = floatingTexts.value.filter(t => t.id !== id);
                    }, 1500);
                };

                const manualClick = () => {
                    if (isPlayerDefeated.value) return;
                    const now = Date.now();
                    if (now - gameState.lastClickTimestamp < 2000) { // 2 second combo window
                        gameState.comboCount = Math.min(10, gameState.comboCount + 1);
                    } else {
                        gameState.comboCount = 1;
                    }
                    
                    if(gameState.comboCount >= 10 && !gameState.comboBonusActive) {
                        gameState.comboBonusActive = true;
                        gameState.comboBonusRoundsLeft = computedStats.value.comboRounds;
                        gameState.maxComboCount = gameState.comboCount;
                    }

                    gameState.lastClickTimestamp = now;
                    
                    gameState.stats.totalClicks++;
                    const comboBonus = 1 + (gameState.comboCount * 0.01);
                    combatProgress.value = Math.min(100, combatProgress.value + (5 * comboBonus));
                };

                const resolveCombat = () => {
                    const playerStats = computedStats.value;
                    const enemy = currentEnemy.value;
                    const rect = actionPanelRef.value.getBoundingClientRect();
                    const position = { x: rect.width / 2, y: rect.height / 2 };

                    let comboMultiplier = 1;
                    if (gameState.comboBonusActive) {
                        comboMultiplier = 1 + (gameState.maxComboCount * 0.05); // 5% bonus per combo point
                        gameState.comboBonusRoundsLeft--;
                        if (gameState.comboBonusRoundsLeft <= 0) {
                            gameState.comboBonusActive = false;
                            gameState.maxComboCount = 0;
                        }
                    }

                    if (playerStats.attack > enemy.defense) {
                        const isCritical = Math.random() < playerStats.critChance;
                        const critMultiplier = isCritical ? playerStats.critDamageMultiplier : 1;
                        
                        const xpGained = enemy.reward.xp * playerStats.xpMultiplier * playerStats.prestigeBonus * critMultiplier * comboMultiplier;
                        let credsGained = enemy.reward.creds * playerStats.prestigeBonus * playerStats.credsMultiplier * critMultiplier * comboMultiplier;
                        
                        gameState.xp += xpGained;
                        addCreds(credsGained);
                        
                        if (!gameState.stats.enemiesDefeated[enemy.id]) {
                            gameState.stats.enemiesDefeated[enemy.id] = 0;
                        }
                        gameState.stats.enemiesDefeated[enemy.id]++;

                        if (isCritical) {
                            showFloatingText('CRÍTICO!', 'var(--crit-color)', { ...position, y: position.y - 60 });
                        }
                        showFloatingText(`+${formatNumber(xpGained)} XP`, 'var(--xp-color)', { ...position, y: position.y - 30 });
                        showFloatingText(`+${formatNumber(credsGained)} Creds`, 'var(--gold-color)', position);

                        if (gameState.xp >= gameState.xpToNextLevel) levelUp();
                    } else {
                        const damageTaken = Math.max(1, enemy.attack - playerStats.defense);
                        gameState.health = Math.max(0, gameState.health - damageTaken);
                        showFloatingText(`-${formatNumber(damageTaken)} Dano`, 'var(--health-color)', position);

                        if (gameState.health <= 0) {
                            isPlayerDefeated.value = true;
                            playerDefeatedTimer.value = 10;
                            const defeatTimer = setInterval(() => {
                                playerDefeatedTimer.value--;
                                if(playerDefeatedTimer.value <= 0) {
                                    clearInterval(defeatTimer);
                                    isPlayerDefeated.value = false;
                                    gameState.health = computedStats.value.maxHealth;
                                }
                            }, 1000);
                        }
                    }
                    combatProgress.value = 0;
                    if (!gameState.comboBonusActive) gameState.comboCount = 0;
                    checkAchievements();
                };
                
                const addCreds = (amount) => {
                    gameState.creds += amount;
                    gameState.stats.totalCreds += amount;
                    const contract = activeContract.value;
                    if(contract && contract.type === 'collect_creds') gameState.contractProgress.collectedCreds += amount;
                };

                const levelUp = () => {
                    while (gameState.xp >= gameState.xpToNextLevel) {
                        gameState.level++;
                        gameState.xp -= gameState.xpToNextLevel;
                        gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
                        if (gameState.level % 5 === 0) gameState.skillPoints++;
                    }
                    if (actionPanelRef.value) {
                        const rect = actionPanelRef.value.getBoundingClientRect();
                        const position = { x: rect.width / 2, y: rect.height / 3 };
                        showFloatingText('NÍVEL UP!', 'var(--highlight-color)', position);
                    }
                };
                
                const buyEquipment = (type, id) => {
                    // This function is now deprecated in favor of loot drops
                };
                
                const equipItem = (type, uniqueId) => {
                    if (gameState.inventory[type] && gameState.inventory[type].find(i => i.uniqueId === uniqueId)) {
                        gameState.equipment[type] = uniqueId;
                    }
                };

                const buyAgent = (id) => {
                    const cost = getAgentCost(id);
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.agents[id] = (gameState.agents[id] || 0) + 1;
                    }
                };

                const trainAttribute = (attr) => {
                    const cost = getTrainCost(attr);
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.attributes[attr]++;
                    }
                };

                const upgradeCombatSpeed = () => {
                    const cost = getCombatSpeedUpgradeCost.value;
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.combatSpeedLevel++;
                    }
                };

                const upgradeCritChance = () => {
                    const cost = getCritChanceUpgradeCost.value;
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.critChanceLevel++;
                    }
                };

                const upgradeCritDamage = () => {
                    const cost = getCritDamageUpgradeCost.value;
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.critDamageLevel++;
                    }
                };

                const upgradeComboDuration = () => {
                    const cost = getComboDurationUpgradeCost.value;
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.comboDurationLevel++;
                    }
                };
                
                const buySkill = (type, id) => {
                    if (type === 'passive') {
                        const skillInfo = skillTree.value.find(s => s.id === id);
                        if (skillInfo && skillInfo.canBuy) {
                            gameState.skillPoints -= skillInfo.cost;
                            gameState.skills.passive[id] = (gameState.skills.passive[id] || 0) + 1;
                        }
                    } else {
                        const skill = skillsData.active.find(s => s.id === id);
                        if (skill && gameState.creds >= skill.cost && !gameState.skills.active[id]) {
                            gameState.creds -= skill.cost;
                            gameState.skills.active[id] = true;
                        }
                    }
                };
                
                const activateSkill = (id) => {
                    const skill = skillsData.active.find(s => s.id === id);
                    if (!skill || (gameState.skillCooldowns[id] || 0) > dayjs().valueOf()) return;
                    gameState.skillCooldowns[id] = dayjs().add(skill.cooldown, 'second').valueOf();
                    if (skill.effect.type === 'multiplier') {
                        gameState.activeEffects.overdrive = { expiry: dayjs().add(skill.duration, 'second').valueOf() };
                    } else if (skill.effect.type === 'instant') {
                        addCreds(computedStats.value.credsPerSecond * skill.effect.value * computedStats.value.prestigeBonus);
                    }
                };

                const checkActiveEffects = () => {
                    const now = dayjs().valueOf();
                    for (const effectKey in gameState.activeEffects) {
                        if (gameState.activeEffects[effectKey] && now > gameState.activeEffects[effectKey].expiry) {
                            delete gameState.activeEffects[effectKey];
                        }
                    }
                };

                const acceptContract = (id) => {
                    if (gameState.activeContractId) return;
                    const contract = contractsData.find(c => c.id === id);
                    if (!contract) return;
                    gameState.activeContractId = id;
                    if (contract.type === 'collect_creds') gameState.contractProgress.collectedCreds = 0;
                };

                const cancelContract = () => gameState.activeContractId = null;

                const claimReward = () => {
                    const contract = activeContract.value;
                    if (!contract || !isContractComplete.value) return;
                    if (contract.reward.type === 'creds') {
                        addCreds(contract.reward.value);
                        showToast(`+${formatNumber(contract.reward.value)} Creds!`, 'fa-file-signature');
                    } else if (contract.reward.type === 'skillPoints') {
                        gameState.skillPoints += contract.reward.value;
                        showToast(`+${formatNumber(contract.reward.value)} PH!`, 'fa-file-signature');
                    }
                    gameState.completedContractIds.push(contract.id);
                    gameState.activeContractId = null;
                };
                
                const isAchievementCompleted = (id) => gameState.completedAchievementIds.includes(id);

                const checkAchievements = () => {
                    achievementsData.forEach(ach => {
                        if (isAchievementCompleted(ach.id)) return;
                        let completed = false;
                        if (ach.type === 'clicks' && gameState.stats.totalClicks >= ach.target) completed = true;
                        else if (ach.type === 'level' && gameState.level >= ach.target) completed = true;
                        else if (ach.type === 'totalCreds' && gameState.stats.totalCreds >= ach.target) completed = true;
                        if (completed) {
                            gameState.completedAchievementIds.push(ach.id);
                            showToast(`Conquista: ${ach.name}`, 'fa-trophy', 'var(--achievement-color)');
                        }
                    });
                };

                const askForConfirmation = (title, message, callback) => {
                    confirmTitle.value = title;
                    confirmMessage.value = message;
                    confirmCallback.value = callback;
                    showConfirmModal.value = true;
                };

                const handleConfirm = () => {
                    if (typeof confirmCallback.value === 'function') confirmCallback.value();
                    cancelConfirm();
                };

                const cancelConfirm = () => {
                    showConfirmModal.value = false;
                    confirmTitle.value = '';
                    confirmMessage.value = '';
                    confirmCallback.value = null;
                };

                const showToast = (message, icon = 'fa-save', color = 'var(--highlight-color)') => {
                    toast.message = message;
                    toast.icon = icon;
                    toast.color = color;
                    toast.show = true;
                    setTimeout(() => { toast.show = false; }, 3000);
                };

                const SAVE_KEY = 'cyberpunkRPGSave_vue';
                const saveGame = (manual = false) => {
                    gameState.lastSaveTimestamp = dayjs().valueOf();
                    localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
                    if (manual) showToast("Jogo Salvo!");
                };

                const loadGame = () => {
                    const savedData = localStorage.getItem(SAVE_KEY);
                    if (savedData) {
                        try {
                            const loadedState = JSON.parse(savedData);
                            const newState = JSON.parse(JSON.stringify(defaultGameState()));
                            const mergeDeep = (target, source) => {
                                for (const key in source) {
                                    if (source.hasOwnProperty(key)) {
                                        const sourceVal = source[key];
                                        if (sourceVal && typeof sourceVal === 'object' && !Array.isArray(sourceVal)) {
                                            if (!target[key] || typeof target[key] !== 'object' || Array.isArray(target[key])) target[key] = {};
                                            mergeDeep(target[key], sourceVal);
                                        } else if (sourceVal !== undefined) {
                                            target[key] = sourceVal;
                                        }
                                    }
                                }
                            };
                            mergeDeep(newState, loadedState);
                            Object.assign(gameState, newState);
                            if (gameState.lastSaveTimestamp) {
                                const secondsOffline = dayjs().diff(dayjs(gameState.lastSaveTimestamp), 'second');
                                const cappedSeconds = Math.min(secondsOffline, 86400); // 24h cap
                                const gains = cappedSeconds * computedStats.value.credsPerSecond * computedStats.value.prestigeBonus;
                                if (gains > 1) {
                                    addCreds(gains);
                                    offlineGains.value = gains;
                                    showOfflineModal.value = true;
                                }
                            }
                        } catch (e) {
                            console.error("Erro ao carregar o jogo salvo. O progresso será resetado.", e);
                            localStorage.removeItem(SAVE_KEY);
                        }
                    }
                    gameState.health = computedStats.value.maxHealth;
                };
                
                const resetGame = () => {
                    localStorage.removeItem(SAVE_KEY);
                    Object.assign(gameState, defaultGameState());
                    gameState.health = computedStats.value.maxHealth;
                };

                const prestigeReset = () => {
                    if (gameState.level < PRESTIGE_LEVEL_REQ) return;
                    const currentPrestige = gameState.prestigePoints;
                    const pointsGained = prestigePointsToGain.value;
                    const completedAchievements = [...gameState.completedAchievementIds];
                    const newState = defaultGameState();
                    newState.prestigePoints = currentPrestige + pointsGained;
                    newState.completedAchievementIds = completedAchievements;
                    Object.assign(gameState, newState);
                    gameState.health = computedStats.value.maxHealth;
                    saveGame();
                };

                const selectEnemy = (enemyId) => {
                    gameState.currentEnemyId = enemyId;
                    combatProgress.value = 0;
                    closeView();
                };

                const triggerRandomEvent = () => {
                    if (activeEvent.value) return;
                    const randomIndex = Math.floor(Math.random() * eventData.length);
                    const newEvent = eventData[randomIndex];
                    gameState.activeEventId = newEvent.id;
                    gameState.eventEndTime = dayjs().add(newEvent.duration, 'second').valueOf();
                };

                let gameLoopInterval, saveInterval, cooldownInterval, eventInterval;

                onMounted(() => {
                    loadGame();
                    const GAME_TICK_RATE = 100; // ms
                    gameLoopInterval = setInterval(() => {
                        if (isPlayerDefeated.value) return;
                        // Agent CPS
                        addCreds((computedStats.value.credsPerSecond * computedStats.value.prestigeBonus) / (1000 / GAME_TICK_RATE));
                        
                        // Combat Cycle Progress
                        if (Date.now() - gameState.lastClickTimestamp > 2000) {
                            gameState.comboCount = 0;
                        }
                        combatProgress.value += (100 / (5000 / GAME_TICK_RATE)) * computedStats.value.combatSpeed; // 5 seconds base cycle
                        if (combatProgress.value >= 100) {
                            resolveCombat();
                        }

                        checkActiveEffects();
                    }, GAME_TICK_RATE);

                    saveInterval = setInterval(() => saveGame(false), 30000);
                    
                    cooldownInterval = setInterval(() => {
                        currentTime.value = dayjs().valueOf();
                        if (activeEvent.value && currentTime.value > gameState.eventEndTime) {
                            gameState.activeEventId = null;
                            gameState.eventEndTime = 0;
                        }
                    }, 1000);

                    eventInterval = setInterval(triggerRandomEvent, 5 * 60 * 1000); // Chance for event every 5 minutes
                });

                watch(() => gameState.attributes.vigor, () => {
                    gameState.health = computedStats.value.maxHealth;
                });

                onUnmounted(() => {
                    clearInterval(gameLoopInterval);
                    clearInterval(saveInterval);
                    clearInterval(cooldownInterval);
                    clearInterval(eventInterval);
                });

                return {
                    // State
                    gameState, equipmentData, agentsData, skillsData, contractsData, achievementsData,
                    activeView, isMenuOpen, shopTabs, floatingTexts, actionPanelRef, toast,
                    showOfflineModal, offlineGains,
                    showConfirmModal, confirmTitle, confirmMessage,
                    combatProgress, isPlayerDefeated, playerDefeatedTimer,
                    activeEvent, activeEventTimer,
                    // Computed
                    computedStats, currentEnemy, prestigePointsToGain, activeSkills,
                    skillTree, activeContract, contractProgress, isContractComplete, availableContracts,
                    isAchievementCompleted, currentViewName, currentViewIcon, getCombatSpeedUpgradeCost,
                    getCritChanceUpgradeCost, getCritDamageUpgradeCost, getComboDurationUpgradeCost,
                    // Methods
                    formatNumber, getItem, getAgentCost, getTrainCost,
                    manualClick, buyEquipment, equipItem, buyAgent, trainAttribute, buySkill, activateSkill,
                    acceptContract, cancelContract, claimReward,
                    saveGame, resetGame, prestigeReset, selectEnemy,
                    askForConfirmation, handleConfirm, cancelConfirm,
                    toggleMenu, openView, closeView, upgradeCombatSpeed, upgradeCritChance, upgradeCritDamage, upgradeComboDuration,
                    PRESTIGE_LEVEL_REQ,
                    enemyData
                };
            }
        }
        
        const app = createApp(appLogic);
        app.mount('#app');
    </script>
</body>
</html>
" in the canvas.
I want to implement the loot and rare items id