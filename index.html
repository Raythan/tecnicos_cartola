<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberpunk RPG Clicker - Edição Vue</title>
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- Numeral.js & Day.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js"></script>

    <style>
        /* Estilos base para fontes e cores customizadas do tema */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0d0208;
            color: #e0e0e0;
        }
        .font-pixel { font-family: 'Press Start 2P', cursive; }
        
        /* Cores como variáveis CSS para fácil acesso no JS se necessário */
        :root {
            --highlight-color: #00ffff;
            --xp-color: #ff00ff;
            --gold-color: #ffd700;
            --skill-color: #39ff14;
            --prestige-color: #f77fbe;
            --achievement-color: #ffdf00;
        }

        /* Animação de texto flutuante */
        @keyframes floatUp {
            to {
                opacity: 0;
                transform: translateY(-80px);
            }
        }
        .floating-text {
            animation: floatUp 1.5s ease-out forwards;
        }

        /* Animação do Toast (Notificação) */
        @keyframes toastInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        .toast {
            animation: toastInRight 0.5s ease-out forwards;
        }

        /* Estilos para a Árvore de Habilidades */
        .skill-node {
            position: relative;
        }
        .skill-node.locked {
            filter: grayscale(80%) brightness(50%);
        }
        .skill-connector {
            position: absolute;
            width: 50%; 
            height: 2px;
            background-color: #4a5568; 
            top: 50%;
            left: 100%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body class="bg-[#0d0208] text-gray-200 p-4">

    <div id="app" class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Coluna da Esquerda: Personagem -->
        <div class="lg:col-span-1 lg:sticky top-6 self-start space-y-6">
            <div class="bg-[#1a1a1a] p-6 rounded-xl border border-gray-700 shadow-lg shadow-cyan-500/10">
                <div class="text-center mb-4">
                    <h1 class="font-pixel text-2xl text-white">Mercenário</h1>
                    <h2 class="font-pixel text-cyan-400">Nível {{ gameState.level }}</h2>
                </div>

                <!-- Itens Equipados -->
                <div class="flex justify-center gap-4 mb-4 p-2 bg-gray-800 rounded-lg">
                    <div v-for="(itemId, type) in gameState.equipment" :key="type" class="w-16 h-16 bg-black/50 rounded-lg flex items-center justify-center text-4xl text-gray-500" :title="getItem(type, itemId)?.name || 'Vazio'">
                        <i v-if="getItem(type, itemId)" :class="['fa-solid', getItem(type, itemId).icon, 'text-cyan-400']"></i>
                        <i v-else class="fa-solid fa-question"></i>
                    </div>
                </div>

                <!-- XP Bar -->
                <div>
                    <div class="bg-gray-800 rounded-full h-4 overflow-hidden">
                        <div class="bg-fuchsia-500 h-4 transition-all duration-300" :style="{ width: `${(gameState.xp / gameState.xpToNextLevel) * 100}%` }"></div>
                    </div>
                    <p class="text-center text-sm mt-1 text-gray-400">{{ formatNumber(gameState.xp) }} / {{ formatNumber(gameState.xpToNextLevel) }} XP</p>
                </div>

                <!-- Recursos -->
                <div class="font-pixel text-lg text-center mt-4 space-y-2">
                    <p class="text-yellow-400"><i class="fas fa-coins"></i> {{ formatNumber(gameState.creds) }}</p>
                    <p class="text-green-400"><i class="fas fa-star"></i> {{ gameState.skillPoints }}</p>
                    <p class="text-pink-400"><i class="fas fa-atom"></i> {{ gameState.prestigePoints }}</p>
                </div>

                 <!-- Atributos e Stats -->
                <div v-for="(items, title) in { 'Atributos': gameState.attributes, 'Estatísticas': computedStats }" :key="title" class="mt-6">
                    <h3 class="font-pixel text-cyan-400 text-sm mb-2">{{ title }}</h3>
                    <div class="grid grid-cols-2 gap-2">
                        <div v-for="(value, key) in items" :key="key" class="bg-gray-800 p-2 rounded-lg text-center">
                            <p class="text-xs capitalize text-gray-400">{{ {attack: 'Ataque', defense: 'Defesa', credsPerClick: 'Creds / Clique', credsPerSecond: 'Creds / Seg', xpMultiplier: 'Bônus de XP', critCredChance: 'Chance de Crítico', prestigeBonus: 'Bônus de Prestígio', achievementBonus: 'Bônus de Conquista'}[key] || key.replace(/([A-Z])/g, ' $1') }}</p>
                            <p class="font-pixel text-lg" :class="{'text-pink-400': key === 'prestigeBonus', 'text-yellow-400': key === 'achievementBonus', 'text-cyan-400': !['prestigeBonus', 'achievementBonus'].includes(key)}">
                                {{ (key.includes('Bonus') || key.includes('Multiplier') ? `+${formatNumber((value - 1) * 100, 2)}%` : (key.includes('Chance') ? `${formatNumber(value * 100, 2)}%` : formatNumber(value))) }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna Central: Ação e Habilidades -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Ação -->
            <div ref="actionPanelRef" class="relative bg-[#1a1a1a] p-6 rounded-xl border border-gray-700 text-center flex flex-col items-center justify-center min-h-[300px]">
                <h2 class="font-pixel text-xl mb-4">Alvo: {{ currentEnemy.name }}</h2>
                <button @click="manualClick" class="transition-transform active:scale-95">
                    <i :class="['fa-solid', currentEnemy.icon, 'text-7xl sm:text-8xl md:text-9xl']" :style="{ color: currentEnemy.color, filter: `drop-shadow(0 0 15px ${currentEnemy.color})` }"></i>
                </button>
                <!-- Textos Flutuantes -->
                <div v-for="text in floatingTexts" :key="text.id" class="floating-text absolute font-pixel text-2xl pointer-events-none" :style="{ top: text.y + 'px', left: text.x + 'px', color: text.color }">
                    {{ text.content }}
                </div>
            </div>

            <!-- Habilidades Ativas -->
            <div class="bg-[#1a1a1a] p-6 rounded-xl border border-gray-700">
                <h2 class="font-pixel text-cyan-400"><i class="fas fa-bolt"></i> Habilidades Ativas</h2>
                <div class="flex justify-center gap-4 mt-4">
                    <button v-for="skill in activeSkills" :key="skill.id" @click="activateSkill(skill.id)" :disabled="skill.onCooldown" class="w-20 h-20 bg-gray-800 border-2 rounded-lg relative overflow-hidden transition-all disabled:grayscale disabled:cursor-not-allowed" :class="skill.onCooldown ? 'border-gray-600' : 'border-green-400 hover:bg-gray-700'" :title="`${skill.name}\n${skill.description}`">
                        <i :class="['fa-solid', skill.icon, 'text-3xl']" :style="{color: skill.onCooldown ? '#666' : 'var(--skill-color)'}"></i>
                        <div v-if="skill.onCooldown" class="absolute inset-0 bg-black/70 flex items-center justify-center font-pixel text-xl text-white">
                            {{ skill.cooldownLeft }}
                        </div>
                    </button>
                </div>
            </div>

            <!-- Loja -->
            <div class="bg-[#1a1a1a] p-6 rounded-xl border border-gray-700">
                <div class="border-b border-gray-700 mb-4">
                    <nav class="-mb-px flex flex-wrap gap-4" aria-label="Tabs">
                        <button v-for="tab in shopTabs" :key="tab.id" @click="activeTab = tab.id" :class="['font-pixel text-sm py-2 px-3 rounded-t-lg transition', activeTab === tab.id ? 'bg-gray-800 text-cyan-400' : 'text-gray-400 hover:text-white']">
                            <i :class="['fa-solid', tab.icon, 'mr-2']"></i>{{ tab.name }}
                        </button>
                    </nav>
                </div>
                <!-- Conteúdo das Abas -->
                <div class="space-y-4">
                    <!-- Equipamentos -->
                    <div v-if="activeTab === 'equipment'" class="space-y-6">
                        <div v-for="(items, type) in equipmentData" :key="type">
                            <h3 class="font-pixel text-cyan-400 capitalize">{{ {arma: 'Armas', armadura: 'Armaduras', implante: 'Implantes'}[type] || type }}</h3>
                            <div class="space-y-2 mt-2">
                                <div v-for="item in items" :key="item.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                    <div>
                                        <p class="font-bold"><i :class="['fa-solid', item.icon, 'mr-2']"></i>{{ item.name }}</p>
                                        <p class="text-sm text-gray-400">+{{ item.bonus.value }} {{ {attack: 'Ataque', defense: 'Defesa', forca: 'Força', destreza: 'Destreza'}[item.bonus.stat] || item.bonus.stat }}</p>
                                    </div>
                                    <button v-if="gameState.equipment[type] === item.id" class="font-pixel text-sm py-2 px-4 rounded-md bg-gray-600" disabled>Equipado</button>
                                    <button v-else-if="gameState.inventory[type] && gameState.inventory[type].includes(item.id)" @click="equipItem(type, item.id)" class="font-pixel text-sm py-2 px-4 rounded-md bg-yellow-500 text-black hover:bg-yellow-400 transition">Equipar</button>
                                    <button v-else @click="buyEquipment(type, item.id)" :disabled="gameState.creds < item.cost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(item.cost) }} Creds</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Agentes -->
                    <div v-if="activeTab === 'agents'" class="space-y-2">
                         <div v-for="agent in agentsData" :key="agent.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <div>
                                <p class="font-bold"><i :class="['fa-solid', agent.icon, 'mr-2']"></i>{{ agent.name }} ({{ gameState.agents[agent.id] || 0 }})</p>
                                <p class="text-sm text-gray-400">+{{ agent.cps }} Creds/s</p>
                            </div>
                            <button @click="buyAgent(agent.id)" :disabled="gameState.creds < getAgentCost(agent.id)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getAgentCost(agent.id)) }} Creds</button>
                         </div>
                    </div>
                    <!-- Treinamento -->
                    <div v-if="activeTab === 'training'" class="space-y-2">
                        <div v-for="(value, attr) in gameState.attributes" :key="attr" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                            <p class="font-bold capitalize">Treinar {{ {forca: 'Força', destreza: 'Destreza', vigor: 'Vigor'}[attr] || attr }}</p>
                            <button @click="trainAttribute(attr)" :disabled="gameState.creds < getTrainCost(attr)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(getTrainCost(attr)) }} Creds</button>
                        </div>
                    </div>
                    <!-- Habilidades -->
                     <div v-if="activeTab === 'skills'" class="space-y-2">
                        <!-- Árvore de Habilidades Passivas -->
                        <div class="flex gap-8 items-start">
                            <div v-for="skill in skillTree" :key="skill.id" class="flex items-center">
                                <div class="flex flex-col items-center">
                                    <div class="skill-node bg-gray-800 p-3 rounded-lg flex flex-col items-center text-center w-48" :class="{ locked: !skill.unlocked }">
                                        <p class="font-bold"><i class="fa-solid fa-star mr-2"></i>{{ skill.name }} ({{ skill.level }}/{{ skill.maxLevel }})</p>
                                        <p class="text-xs text-gray-400 my-2 h-10">{{ skill.description }}</p>
                                        <button @click="buySkill('passive', skill.id)" :disabled="!skill.canBuy" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-green-500 text-black hover:bg-green-400 transition disabled:bg-gray-700 disabled:text-gray-400 disabled:cursor-not-allowed">{{ skill.buttonText }}</button>
                                        <div v-if="skill.requires" class="skill-connector"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="border-gray-700 my-6">
                        <!-- Habilidades Ativas -->
                         <div v-for="skill in skillsData.active.filter(s => !gameState.skills.active[s.id])" :key="skill.id">
                             <div class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                 <div>
                                     <p class="font-bold"><i :class="['fa-solid', skill.icon, 'mr-2']"></i>{{ skill.name }}</p>
                                     <p class="text-sm text-gray-400">{{ skill.description }}</p>
                                 </div>
                                 <button @click="buySkill('active', skill.id)" :disabled="gameState.creds < skill.cost" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition disabled:bg-gray-700 disabled:text-gray-400">{{ formatNumber(skill.cost) }} Creds</button>
                             </div>
                         </div>
                    </div>
                    <!-- Contratos -->
                    <div v-if="activeTab === 'contracts'">
                        <div v-if="activeContract" class="bg-gray-800 p-4 rounded-lg">
                            <h3 class="font-pixel text-cyan-400">{{ activeContract.name }}</h3>
                            <p class="text-sm text-gray-400 my-2">{{ activeContract.description }}</p>
                            <div class="w-full bg-gray-900 rounded-full h-2.5">
                                <div class="bg-green-500 h-2.5 rounded-full" :style="{width: contractProgress.percentage + '%'}"></div>
                            </div>
                            <p class="text-center text-sm mt-1">{{ contractProgress.text }}</p>
                            <div class="mt-4 flex gap-4">
                                <button v-if="isContractComplete" @click="claimReward" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-green-500 text-black hover:bg-green-400 transition">Coletar Recompensa</button>
                                <button v-else @click="cancelContract" class="w-full font-pixel text-sm py-2 px-4 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Cancelar</button>
                            </div>
                        </div>
                        <div v-else class="space-y-2">
                            <p class="text-center text-gray-400 mb-4">Nenhum contrato ativo. Escolha um abaixo.</p>
                            <div v-for="contract in availableContracts" :key="contract.id" class="flex items-center justify-between bg-gray-800 p-3 rounded-lg">
                                <div>
                                    <p class="font-bold">{{ contract.name }}</p>
                                    <p class="text-sm text-gray-400">Recompensa: {{ formatNumber(contract.reward.value) }} {{ contract.reward.type === 'creds' ? 'Creds' : 'PH' }}</p>
                                </div>
                                <button @click="acceptContract(contract.id)" class="font-pixel text-sm py-2 px-4 rounded-md bg-cyan-400 text-black hover:bg-cyan-300 transition">Aceitar</button>
                            </div>
                             <p v-if="!availableContracts.length" class="text-center text-gray-500">Nenhum contrato disponível no momento. Volte mais tarde.</p>
                        </div>
                    </div>
                    <!-- Conquistas -->
                    <div v-if="activeTab === 'achievements'" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="achievement in achievementsData" :key="achievement.id" class="bg-gray-800 p-3 rounded-lg flex items-center gap-4" :class="{'opacity-50': !isAchievementCompleted(achievement.id)}">
                            <i class="fa-solid fa-trophy text-3xl" :class="isAchievementCompleted(achievement.id) ? 'text-yellow-400' : 'text-gray-600'"></i>
                            <div>
                                <p class="font-bold">{{ achievement.name }}</p>
                                <p class="text-xs text-gray-400">{{ achievement.description }}</p>
                                <p v-if="isAchievementCompleted(achievement.id)" class="text-xs text-green-400 font-bold">Bônus: {{ achievement.bonus.description }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
             <!-- Controles -->
            <div class="bg-[#1a1a1a] p-6 rounded-xl border border-gray-700">
                <h2 class="font-pixel text-cyan-400"><i class="fas fa-cogs"></i> Sistema</h2>
                <div class="flex flex-col gap-4 mt-4">
                    <button @click="saveGame(true)" class="font-pixel text-sm py-3 px-4 rounded-md bg-cyan-500 text-black hover:bg-cyan-400 transition">Salvar Manualmente</button>
                    <button @click="askForConfirmation('Resetar Jogo', 'Você tem certeza que quer apagar todo o progresso? Esta ação não pode ser desfeita.', resetGame)" class="font-pixel text-sm py-3 px-4 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Resetar Jogo</button>
                    <button v-if="gameState.level >= PRESTIGE_LEVEL_REQ" @click="askForConfirmation('Prestigiar', `Você tem certeza? Seu progresso será resetado, mas você ganhará ${prestigePointsToGain} Fragmentos de IA como bônus permanente.`, prestigeReset)" class="font-pixel text-sm py-3 px-4 rounded-md bg-gradient-to-r from-pink-500 to-fuchsia-500 text-white hover:opacity-90 transition">Prestigiar (+{{ prestigePointsToGain }} Fragmentos)</button>
                </div>
            </div>
        </div>
        
        <!-- Modal Offline -->
        <div v-if="showOfflineModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate__animated animate__fadeIn">
            <div class="bg-[#1a1a1a] p-8 rounded-xl border-2 border-cyan-400 text-center max-w-sm w-full animate__animated animate__zoomIn">
                <h2 class="font-pixel text-2xl text-cyan-400">Bem-vindo de volta!</h2>
                <p class="my-4 text-lg">Enquanto esteve fora, seus agentes mineraram:</p>
                <p class="font-pixel text-2xl text-yellow-400">{{ formatNumber(offlineGains) }} Creds</p>
                <button @click="showOfflineModal = false" class="mt-6 font-pixel text-sm py-3 px-6 rounded-md bg-cyan-500 text-black hover:bg-cyan-400 transition">Coletar</button>
            </div>
        </div>

        <!-- Modal de Confirmação -->
        <div v-if="showConfirmModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 animate__animated animate__fadeIn">
            <div class="bg-[#1a1a1a] p-8 rounded-xl border-2 border-red-500 text-center max-w-sm w-full animate__animated animate__zoomIn">
                <h2 class="font-pixel text-2xl text-red-500">{{ confirmTitle }}</h2>
                <p class="my-4 text-lg">{{ confirmMessage }}</p>
                <div class="flex justify-center gap-4 mt-6">
                    <button @click="cancelConfirm" class="font-pixel text-sm py-3 px-6 rounded-md bg-gray-600 text-white hover:bg-gray-500 transition">Cancelar</button>
                    <button @click="handleConfirm" class="font-pixel text-sm py-3 px-6 rounded-md bg-red-600 text-white hover:bg-red-500 transition">Confirmar</button>
                </div>
            </div>
        </div>

        <!-- Notificação (Toast) -->
        <div v-if="toast.show" class="toast fixed bottom-5 right-5 bg-cyan-500 text-black font-pixel text-sm p-4 rounded-lg shadow-lg z-50" :style="{backgroundColor: toast.color || 'var(--highlight-color)'}">
            <i :class="['fa-solid', toast.icon, 'mr-2']"></i>{{ toast.message }}
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted, onUnmounted } = Vue;

        createApp({
            setup() {
                // --- GAME DATA (Constants) ---
                const PRESTIGE_LEVEL_REQ = 50;
                const equipmentData = {
                    arma: [ { id: 'w1', name: 'Pistola Básica', cost: 50, icon: 'fa-gun', bonus: { stat: 'attack', value: 2 } }, { id: 'w2', name: 'Submetralhadora', cost: 250, icon: 'fa-dragon', bonus: { stat: 'attack', value: 10 } }, { id: 'w3', name: 'Rifle de Precisão', cost: 1200, icon: 'fa-bullseye', bonus: { stat: 'attack', value: 40 } }, ],
                    armadura: [ { id: 'a1', name: 'Jaqueta Reforçada', cost: 75, icon: 'fa-shirt', bonus: { stat: 'defense', value: 5 } }, { id: 'a2', name: 'Colete de Kevlar', cost: 300, icon: 'fa-user-shield', bonus: { stat: 'defense', value: 20 } }, { id: 'a3', name: 'Placas de Titânio', cost: 1500, icon: 'fa-shield-halved', bonus: { stat: 'defense', value: 80 } }, ],
                    implante: [ { id: 'i1', name: 'Olho Cibernético', cost: 500, icon: 'fa-eye', bonus: { stat: 'destreza', value: 5 } }, { id: 'i2', name: 'Braço Hidráulico', cost: 800, icon: 'fa-robot', bonus: { stat: 'forca', value: 8 } }, ]
                };
                const agentsData = [ { id: 'ag1', name: 'Drone de Mineração', cost: 1000, icon: 'fa-helicopter', cps: 0.5 }, { id: 'ag2', name: 'Bot de Trading', cost: 5000, icon: 'fa-chart-line', cps: 3 }, { id: 'ag3', name: 'IA de Investimento', cost: 25000, icon: 'fa-brain', cps: 15 } ];
                const enemyData = [ { id: 'e1', level: 1, name: 'Drone de Segurança', icon: 'fa-crosshairs', color: '#f04a4a' }, { id: 'e2', level: 5, name: 'Guarda Corporativo', icon: 'fa-user-shield', color: '#f0a04a' }, { id: 'e3', level: 10, name: 'Mecha de Patrulha', icon: 'fa-robot', color: '#e0e0e0' }, { id: 'e4', level: 20, name: 'Netrunner Inimigo', icon: 'fa-user-secret', color: '#ff00ff' }, ];
                const skillsData = {
                    passive: [ 
                        { id: 'p1', name: 'Protocolo de Eficiência', maxLevel: 5, cost: 1, description: 'Aumenta o ganho de XP em 5% por nível.', bonus: { stat: 'xpMultiplier', value: 0.05 }, requires: null }, 
                        { id: 'p2', name: 'Conexão Neural', maxLevel: 5, cost: 1, description: 'Aumenta a chance de drop de créditos em 2% por nível.', bonus: { stat: 'critCredChance', value: 0.02 }, requires: 'p1' } 
                    ],
                    active: [ { id: 'ac1', name: 'Overdrive', cost: 2500, icon: 'fa-bolt', description: 'Aumenta o dano do clique em 200% por 10s.', cooldown: 60, duration: 10, effect: { type: 'multiplier', stat: 'clickDamage', value: 2 } }, { id: 'ac2', name: 'Hack de Créditos', cost: 5000, icon: 'fa-sack-dollar', description: 'Gera instantaneamente o equivalente a 30 segundos de ganhos.', cooldown: 120, effect: { type: 'instant', stat: 'creds', value: 30 } } ]
                };
                const contractsData = [
                    { id: 'c1', name: 'Exterminar Drones', description: 'Derrube Drones de Segurança para coletar seus componentes.', type: 'kill', target: 'e1', targetCount: 50, minLevel: 1, reward: { type: 'creds', value: 2500 } },
                    { id: 'c2', name: 'Limpeza Corporativa', description: 'Elimine os Guardas Corporativos que patrulham a área.', type: 'kill', target: 'e2', targetCount: 25, minLevel: 5, reward: { type: 'creds', value: 5000 } },
                    { id: 'c3', name: 'Primeiros Passos', description: 'Acumule uma pequena fortuna para provar seu valor.', type: 'collect_creds', targetCount: 10000, minLevel: 1, reward: { type: 'skillPoints', value: 1 } }
                ];
                const achievementsData = [
                    { id: 'ach1', name: 'Clicador Iniciante', description: 'Clique 100 vezes.', type: 'clicks', target: 100, bonus: { stat: 'globalMultiplier', value: 0.01, description: '+1% de ganhos de Creds' } },
                    { id: 'ach2', name: 'Mercenário Novato', description: 'Alcance o nível 10.', type: 'level', target: 10, bonus: { stat: 'globalMultiplier', value: 0.02, description: '+2% de ganhos de XP' } },
                    { id: 'ach3', name: 'Pequeno Investidor', description: 'Acumule 10.000 Creds.', type: 'totalCreds', target: 10000, bonus: { stat: 'globalMultiplier', value: 0.02, description: '+2% de ganhos de Creds' } },
                ];

                // --- GAME STATE (Reactive) ---
                const defaultGameState = () => ({
                    level: 1, xp: 0, xpToNextLevel: 100, creds: 0, skillPoints: 0, prestigePoints: 0,
                    lastSaveTimestamp: dayjs().valueOf(),
                    attributes: { forca: 1, destreza: 1, vigor: 1 },
                    equipment: { arma: null, armadura: null, implante: null },
                    inventory: { arma: [], armadura: [], implante: [] },
                    agents: {},
                    skills: { passive: {}, active: {} },
                    activeEffects: {},
                    skillCooldowns: {},
                    activeContractId: null,
                    contractProgress: { kills: {}, collectedCreds: 0 },
                    completedContractIds: [],
                    stats: { totalClicks: 0, totalCreds: 0 },
                    completedAchievementIds: [],
                });
                const gameState = reactive(defaultGameState());

                // --- UI STATE ---
                const activeTab = ref('equipment');
                const shopTabs = [
                    { id: 'equipment', name: 'Equipamentos', icon: 'fa-store' },
                    { id: 'agents', name: 'Agentes', icon: 'fa-users' },
                    { id: 'training', name: 'Treinamento', icon: 'fa-dumbbell' },
                    { id: 'skills', name: 'Habilidades', icon: 'fa-brain' },
                    { id: 'contracts', name: 'Contratos', icon: 'fa-file-signature' },
                    { id: 'achievements', name: 'Conquistas', icon: 'fa-trophy' },
                ];
                const floatingTexts = ref([]);
                const actionPanelRef = ref(null);
                const toast = reactive({ show: false, message: '', icon: 'fa-save', color: 'var(--highlight-color)' });
                const showOfflineModal = ref(false);
                const offlineGains = ref(0);
                const showConfirmModal = ref(false);
                const confirmTitle = ref('');
                const confirmMessage = ref('');
                const confirmCallback = ref(null);
                
                // --- COMPUTED PROPERTIES ---
                const achievementBonus = computed(() => {
                    const bonuses = { globalMultiplier: 1, xpMultiplier: 1 };
                    gameState.completedAchievementIds.forEach(id => {
                        const achievement = achievementsData.find(a => a.id === id);
                        if (achievement) {
                            bonuses[achievement.bonus.stat] += achievement.bonus.value;
                        }
                    });
                    return bonuses;
                });

                const computedStats = computed(() => {
                    const base = gameState.attributes;
                    const eqIds = gameState.equipment;
                    
                    const achBonus = achievementBonus.value;
                    const prestigeBonus = 1 + (gameState.prestigePoints * 0.01);
                    let passiveBonuses = { xpMultiplier: 1, critCredChance: 0 };
                    for (const skillId in gameState.skills.passive) {
                        const skillLevel = gameState.skills.passive[skillId];
                        const skillInfo = skillsData.passive.find(s => s.id === skillId);
                        if (skillInfo) {
                            passiveBonuses[skillInfo.bonus.stat] += skillInfo.bonus.value * skillLevel;
                        }
                    }

                    const equippedImplante = getItem('implante', eqIds.implante);
                    let currentForca = base.forca + (equippedImplante?.bonus.stat === 'forca' ? equippedImplante.bonus.value : 0);
                    let currentDestreza = base.destreza + (equippedImplante?.bonus.stat === 'destreza' ? equippedImplante.bonus.value : 0);
                    
                    let totalAttack = currentForca * 2 + currentDestreza;
                    let totalDefense = base.vigor * 3;
                    const equippedArma = getItem('arma', eqIds.arma);
                    if (equippedArma) totalAttack += equippedArma.bonus.value;
                    const equippedArmadura = getItem('armadura', eqIds.armadura);
                    if (equippedArmadura) totalDefense += equippedArmadura.bonus.value;
                    
                    let totalCps = 0;
                    for (const agentId in gameState.agents) {
                        const agentInfo = agentsData.find(a => a.id === agentId);
                        if (agentInfo) totalCps += gameState.agents[agentId] * agentInfo.cps;
                    }

                    return {
                        attack: totalAttack,
                        defense: totalDefense,
                        credsPerClick: Math.floor((1 + totalAttack / 5) * achBonus.globalMultiplier),
                        credsPerSecond: totalCps * achBonus.globalMultiplier,
                        xpMultiplier: passiveBonuses.xpMultiplier * achBonus.xpMultiplier,
                        critCredChance: passiveBonuses.critCredChance,
                        prestigeBonus,
                        achievementBonus: achBonus.globalMultiplier,
                    };
                });

                const currentEnemy = computed(() => [...enemyData].reverse().find(e => gameState.level >= e.level) || enemyData[0]);
                const prestigePointsToGain = computed(() => Math.floor(gameState.level / 20));

                const activeSkills = computed(() => {
                    return skillsData.active
                        .filter(skill => gameState.skills.active[skill.id])
                        .map(skill => {
                            const cooldownEnd = gameState.skillCooldowns[skill.id] || 0;
                            const now = dayjs().valueOf();
                            const onCooldown = cooldownEnd > now;
                            return {
                                ...skill,
                                onCooldown,
                                cooldownLeft: onCooldown ? dayjs(cooldownEnd).diff(now, 'second') : 0
                            };
                        });
                });
                
                const skillTree = computed(() => {
                    return skillsData.passive.map(skill => {
                        const level = gameState.skills.passive[skill.id] || 0;
                        const isMaxed = level >= skill.maxLevel;
                        const hasRequirement = skill.requires ? (gameState.skills.passive[skill.requires] || 0) > 0 : true;
                        const unlocked = hasRequirement;
                        const canBuy = unlocked && !isMaxed && gameState.skillPoints >= skill.cost;
                        
                        let buttonText = 'BLOQUEADO';
                        if (unlocked) {
                            if (isMaxed) {
                                buttonText = 'MÁX';
                            } else {
                                buttonText = `${skill.cost} PH`;
                            }
                        }

                        return {
                            ...skill,
                            level,
                            unlocked,
                            canBuy,
                            buttonText
                        };
                    });
                });

                const activeContract = computed(() => {
                    if (!gameState.activeContractId) return null;
                    return contractsData.find(c => c.id === gameState.activeContractId);
                });
                
                const availableContracts = computed(() => {
                    return contractsData.filter(c => 
                        c.minLevel <= gameState.level && 
                        !gameState.completedContractIds.includes(c.id)
                    );
                });

                const contractProgress = computed(() => {
                    const contract = activeContract.value;
                    if (!contract) return { percentage: 0, text: '' };

                    let current = 0;
                    if (contract.type === 'kill') {
                        current = gameState.contractProgress.kills[contract.target] || 0;
                    } else if (contract.type === 'collect_creds') {
                        current = gameState.contractProgress.collectedCreds || 0;
                    }
                    
                    const percentage = Math.min(100, (current / contract.targetCount) * 100);
                    const text = `${formatNumber(current)} / ${formatNumber(contract.targetCount)}`;

                    return { percentage, text };
                });

                const isContractComplete = computed(() => {
                    return contractProgress.value.percentage >= 100;
                });

                // --- METHODS ---
                const formatNumber = (num, decimals = 0) => {
                    if (num === undefined || num === null || isNaN(num)) return '0';
                    const formatString = decimals > 0 ? `0,0.[${'0'.repeat(decimals)}]a` : '0,0a';
                    return numeral(num).format(formatString).toUpperCase();
                }
                const getItem = (type, id) => equipmentData[type]?.find(i => i.id === id) || null;
                
                const getAgentCost = (id) => {
                    const agent = agentsData.find(a => a.id === id);
                    if (!agent) return Infinity;
                    const cost = Math.floor(agent.cost * Math.pow(1.15, gameState.agents[id] || 0));
                    return isNaN(cost) ? Infinity : cost;
                };
                
                const getTrainCost = (attr) => {
                    const cost = Math.floor(10 * Math.pow(1.2, gameState.attributes[attr]));
                    return isNaN(cost) ? Infinity : cost;
                };

                const showFloatingText = (content, event, color) => {
                    if (!actionPanelRef.value) return;
                    const id = Date.now() + Math.random();
                    const rect = actionPanelRef.value.getBoundingClientRect();
                    floatingTexts.value.push({
                        id, content, color,
                        x: event.clientX - rect.left,
                        y: event.clientY - rect.top
                    });
                    setTimeout(() => {
                        floatingTexts.value = floatingTexts.value.filter(t => t.id !== id);
                    }, 1500);
                };

                const manualClick = (event) => {
                    gameState.stats.totalClicks++;
                    let clickDamageMultiplier = 1;
                    if (gameState.activeEffects.overdrive) {
                        const skillInfo = skillsData.active.find(s=>s.id==='ac1');
                        if(skillInfo) clickDamageMultiplier += skillInfo.effect.value;
                    }

                    const stats = computedStats.value;
                    const xpGained = Math.max(1, Math.floor((stats.attack * clickDamageMultiplier) / 2)) * stats.xpMultiplier * stats.prestigeBonus;
                    let credsGained = stats.credsPerClick * stats.prestigeBonus;
                    if (Math.random() < stats.critCredChance) credsGained *= 2;

                    gameState.xp += xpGained;
                    addCreds(credsGained);
                    
                    showFloatingText(`+${formatNumber(xpGained)} XP`, event, 'var(--xp-color)');
                    showFloatingText(`+${formatNumber(credsGained)}`, event, 'var(--gold-color)');
                    
                    const contract = activeContract.value;
                    if (contract && contract.type === 'kill' && contract.target === currentEnemy.value.id) {
                        if (!gameState.contractProgress.kills[contract.target]) {
                            gameState.contractProgress.kills[contract.target] = 0;
                        }
                        gameState.contractProgress.kills[contract.target]++;
                    }

                    if (gameState.xp >= gameState.xpToNextLevel) levelUp();
                    checkAchievements();
                };
                
                const addCreds = (amount) => {
                    gameState.creds += amount;
                    gameState.stats.totalCreds += amount;
                    const contract = activeContract.value;
                    if(contract && contract.type === 'collect_creds') {
                        gameState.contractProgress.collectedCreds += amount;
                    }
                };

                const levelUp = () => {
                    while (gameState.xp >= gameState.xpToNextLevel) {
                        gameState.level++;
                        gameState.xp -= gameState.xpToNextLevel;
                        gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
                        if (gameState.level % 5 === 0) gameState.skillPoints++;
                    }
                    if (actionPanelRef.value) {
                        const rect = actionPanelRef.value.getBoundingClientRect();
                        showFloatingText('NÍVEL UP!', { clientX: rect.left + rect.width / 2, clientY: rect.top + rect.height / 3 }, 'var(--highlight-color)');
                    }
                    checkAchievements();
                };
                
                const buyEquipment = (type, id) => {
                    const item = getItem(type, id);
                    if (!item || gameState.creds < item.cost) return;
                    
                    if (!gameState.inventory[type]) {
                        gameState.inventory[type] = [];
                    }

                    if (!gameState.inventory[type].includes(id)) {
                        gameState.creds -= item.cost;
                        gameState.inventory[type].push(id);
                    }
                };
                
                const equipItem = (type, id) => {
                    if (gameState.inventory[type] && gameState.inventory[type].includes(id)) {
                        gameState.equipment[type] = id;
                    }
                };

                const buyAgent = (id) => {
                    const cost = getAgentCost(id);
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.agents[id] = (gameState.agents[id] || 0) + 1;
                    }
                };

                const trainAttribute = (attr) => {
                    const cost = getTrainCost(attr);
                    if (gameState.creds >= cost) {
                        gameState.creds -= cost;
                        gameState.attributes[attr]++;
                    }
                };
                
                const buySkill = (type, id) => {
                    if (type === 'passive') {
                        const skillInfo = skillTree.value.find(s => s.id === id);
                        if (skillInfo && skillInfo.canBuy) {
                            gameState.skillPoints -= skillInfo.cost;
                            gameState.skills.passive[id] = (gameState.skills.passive[id] || 0) + 1;
                        }
                    } else {
                        const skill = skillsData.active.find(s => s.id === id);
                        if (skill && gameState.creds >= skill.cost && !gameState.skills.active[id]) {
                            gameState.creds -= skill.cost;
                            gameState.skills.active[id] = true;
                        }
                    }
                };
                
                const activateSkill = (id) => {
                    const skill = skillsData.active.find(s => s.id === id);
                    if (!skill || (gameState.skillCooldowns[id] || 0) > dayjs().valueOf()) return;

                    gameState.skillCooldowns[id] = dayjs().add(skill.cooldown, 'second').valueOf();

                    if (skill.effect.type === 'multiplier') {
                        gameState.activeEffects.overdrive = { 
                            expiry: dayjs().add(skill.duration, 'second').valueOf() 
                        };
                    } else if (skill.effect.type === 'instant') {
                        addCreds(computedStats.value.credsPerSecond * skill.effect.value * computedStats.value.prestigeBonus);
                    }
                };

                const checkActiveEffects = () => {
                    const now = dayjs().valueOf();
                    for (const effectKey in gameState.activeEffects) {
                        if (gameState.activeEffects[effectKey] && now > gameState.activeEffects[effectKey].expiry) {
                            delete gameState.activeEffects[effectKey];
                        }
                    }
                };

                // --- CONTRACTS METHODS ---
                const acceptContract = (id) => {
                    if (gameState.activeContractId) return;
                    const contract = contractsData.find(c => c.id === id);
                    if (!contract) return;

                    gameState.activeContractId = id;
                    if (contract.type === 'kill') {
                        gameState.contractProgress.kills[contract.target] = 0;
                    } else if (contract.type === 'collect_creds') {
                        gameState.contractProgress.collectedCreds = 0;
                    }
                };

                const cancelContract = () => {
                    gameState.activeContractId = null;
                };

                const claimReward = () => {
                    const contract = activeContract.value;
                    if (!contract || !isContractComplete.value) return;

                    if (contract.reward.type === 'creds') {
                        addCreds(contract.reward.value);
                        showToast(`+${formatNumber(contract.reward.value)} Creds!`, 'fa-file-signature');
                    } else if (contract.reward.type === 'skillPoints') {
                        gameState.skillPoints += contract.reward.value;
                        showToast(`+${contract.reward.value} PH!`, 'fa-file-signature');
                    }
                    
                    gameState.completedContractIds.push(contract.id);
                    gameState.activeContractId = null;
                };
                
                // --- ACHIEVEMENTS METHODS ---
                const isAchievementCompleted = (id) => gameState.completedAchievementIds.includes(id);

                const checkAchievements = () => {
                    achievementsData.forEach(ach => {
                        if (isAchievementCompleted(ach.id)) return;

                        let completed = false;
                        if (ach.type === 'clicks' && gameState.stats.totalClicks >= ach.target) {
                            completed = true;
                        } else if (ach.type === 'level' && gameState.level >= ach.target) {
                            completed = true;
                        } else if (ach.type === 'totalCreds' && gameState.stats.totalCreds >= ach.target) {
                            completed = true;
                        }

                        if (completed) {
                            gameState.completedAchievementIds.push(ach.id);
                            showToast(`Conquista: ${ach.name}`, 'fa-trophy', 'var(--achievement-color)');
                        }
                    });
                };

                // --- MODALS & NOTIFICATIONS ---
                const askForConfirmation = (title, message, callback) => {
                    confirmTitle.value = title;
                    confirmMessage.value = message;
                    confirmCallback.value = callback;
                    showConfirmModal.value = true;
                };

                const handleConfirm = () => {
                    if (typeof confirmCallback.value === 'function') {
                        confirmCallback.value();
                    }
                    cancelConfirm();
                };

                const cancelConfirm = () => {
                    showConfirmModal.value = false;
                    confirmTitle.value = '';
                    confirmMessage.value = '';
                    confirmCallback.value = null;
                };

                const showToast = (message, icon = 'fa-save', color = 'var(--highlight-color)') => {
                    toast.message = message;
                    toast.icon = icon;
                    toast.color = color;
                    toast.show = true;
                    setTimeout(() => {
                        toast.show = false;
                    }, 3000);
                };

                // --- SAVE, LOAD, RESET, PRESTIGE ---
                const SAVE_KEY = 'cyberpunkRPGSave_vue';
                const saveGame = (manual = false) => {
                    gameState.lastSaveTimestamp = dayjs().valueOf();
                    localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
                    if (manual) {
                        showToast("Jogo Salvo!");
                    }
                };

                const loadGame = () => {
                    const savedData = localStorage.getItem(SAVE_KEY);
                    if (savedData) {
                        try {
                            const loadedState = JSON.parse(savedData);
                            const newState = JSON.parse(JSON.stringify(defaultGameState()));

                            const mergeDeep = (target, source) => {
                                for (const key in source) {
                                    if (source.hasOwnProperty(key)) {
                                        const sourceVal = source[key];
                                        if (sourceVal && typeof sourceVal === 'object' && !Array.isArray(sourceVal)) {
                                            if (!target[key] || typeof target[key] !== 'object' || Array.isArray(target[key])) {
                                                target[key] = {};
                                            }
                                            mergeDeep(target[key], sourceVal);
                                        } 
                                        else if (sourceVal !== undefined) {
                                            target[key] = sourceVal;
                                        }
                                    }
                                }
                            };

                            mergeDeep(newState, loadedState);
                            Object.assign(gameState, newState);

                            if (gameState.lastSaveTimestamp) {
                                const secondsOffline = dayjs().diff(dayjs(gameState.lastSaveTimestamp), 'second');
                                const cappedSeconds = Math.min(secondsOffline, 86400); // 24h cap
                                const gains = cappedSeconds * computedStats.value.credsPerSecond * computedStats.value.prestigeBonus;
                                if (gains > 1) {
                                    addCreds(gains);
                                    offlineGains.value = gains;
                                    showOfflineModal.value = true;
                                }
                            }
                        } catch (e) {
                            console.error("Erro ao carregar o jogo salvo. O progresso será resetado.", e);
                            localStorage.removeItem(SAVE_KEY);
                        }
                    }
                };
                
                const resetGame = () => {
                    localStorage.removeItem(SAVE_KEY);
                    Object.assign(gameState, defaultGameState());
                };

                const prestigeReset = () => {
                    if (gameState.level < PRESTIGE_LEVEL_REQ) return;
                    const currentPrestige = gameState.prestigePoints;
                    const pointsGained = prestigePointsToGain.value;
                    const completedAchievements = [...gameState.completedAchievementIds];
                    
                    const newState = defaultGameState();
                    newState.prestigePoints = currentPrestige + pointsGained;
                    newState.completedAchievementIds = completedAchievements; // Manter conquistas após prestigiar
                    Object.assign(gameState, newState);

                    saveGame();
                };

                // --- GAME LOOP ---
                let gameLoopInterval;
                let saveInterval;
                onMounted(() => {
                    loadGame();
                    gameLoopInterval = setInterval(() => {
                        const stats = computedStats.value;
                        addCreds((stats.credsPerSecond * stats.prestigeBonus) / 10);
                        checkActiveEffects();
                        checkAchievements();
                    }, 100);
                    saveInterval = setInterval(() => saveGame(false), 30000);
                });
                onUnmounted(() => {
                    clearInterval(gameLoopInterval);
                    clearInterval(saveInterval);
                });

                return {
                    gameState, equipmentData, agentsData, skillsData, contractsData, achievementsData,
                    activeTab, shopTabs, floatingTexts, actionPanelRef, toast,
                    showOfflineModal, offlineGains,
                    showConfirmModal, confirmTitle, confirmMessage,
                    computedStats, currentEnemy, prestigePointsToGain, activeSkills,
                    skillTree,
                    activeContract, contractProgress, isContractComplete, availableContracts,
                    isAchievementCompleted,
                    formatNumber, getItem, getAgentCost, getTrainCost,
                    manualClick, buyEquipment, equipItem, buyAgent, trainAttribute, buySkill, activateSkill,
                    acceptContract, cancelContract, claimReward,
                    saveGame, resetGame, prestigeReset,
                    askForConfirmation, handleConfirm, cancelConfirm,
                    PRESTIGE_LEVEL_REQ
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
