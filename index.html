<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberpunk RPG Clicker</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- Estilos (style.css) - Tema Cyberpunk RPG --- */

        :root {
            --bg-color: #0d0208;
            --primary-color: #1a1a1a;
            --secondary-color: #2a2a2a;
            --accent-color: #e0e0e0;
            --highlight-color: #00ffff; /* Ciano Cyberpunk */
            --xp-color: #ff00ff; /* Magenta para XP */
            --gold-color: #ffd700; /* Dourado para Creds */
            --danger-color: #f04a4a;
            --skill-color: #39ff14; /* Verde para Habilidades */
            --font-pixel: 'Press+Start+2P', cursive;
            --font-main: 'Roboto', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--accent-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-areas:
                "character"
                "action"
                "skills"
                "shop"
                "controls";
            gap: 1.5rem;
        }
        
        /* --- Painéis --- */
        .panel {
            background-color: var(--primary-color);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--secondary-color);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.1);
        }

        .panel h2 {
            font-family: var(--font-pixel);
            font-size: 1.2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            color: var(--highlight-color);
            text-shadow: 0 0 5px var(--highlight-color);
        }
        
        /* --- Painel do Personagem --- */
        .character-panel { grid-area: character; }
        
        .char-header { text-align: center; margin-bottom: 1rem; }
        .char-header h1 { font-family: var(--font-pixel); font-size: 1.5rem; }
        .char-header #level-display { color: var(--highlight-color); }

        .resources-display {
            display: flex;
            justify-content: space-around;
            margin-top: 1rem;
            font-family: var(--font-pixel);
            font-size: 1.2rem;
        }
        #creds-display { color: var(--gold-color); }
        #skill-points-display { color: var(--skill-color); }

        .equipped-items-display {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background: var(--secondary-color);
            border-radius: 8px;
        }
        .equipped-slot {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            border: 1px solid var(--secondary-color);
            border-radius: 8px;
            color: #666;
        }
        .equipped-slot .fa-solid { color: var(--highlight-color); }
        
        .xp-bar-container { background: var(--secondary-color); border-radius: 5px; overflow: hidden; margin-bottom: 0.5rem; }
        #xp-bar { width: 0%; height: 15px; background: var(--xp-color); transition: width 0.3s ease; }
        #xp-text { font-size: 0.8rem; text-align: center; color: #ccc;}

        .attributes-grid, .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        
        .attribute-item, .stat-item { background: var(--secondary-color); padding: 0.75rem; border-radius: 8px; text-align: center; }
        .attribute-item .label, .stat-item .label { font-weight: bold; }
        .attribute-item .value, .stat-item .value { font-family: var(--font-pixel); font-size: 1.2rem; color: var(--highlight-color); }

        /* --- Painel de Ação e Habilidades --- */
        .action-panel { grid-area: action; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        #action-button { background: none; border: none; cursor: pointer; transition: transform 0.1s; }
        #enemy-icon { font-size: clamp(8rem, 25vw, 12rem); color: var(--danger-color); filter: drop-shadow(0 0 15px var(--danger-color)); transition: color 0.5s, transform 0.3s; }
        #action-button:active #enemy-icon { transform: scale(0.95); }
        
        .skills-panel { grid-area: skills; }
        .skills-bar { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .skill-button {
            background-color: var(--secondary-color);
            border: 2px solid var(--skill-color);
            color: var(--skill-color);
            width: 70px;
            height: 70px;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .skill-button .fa-solid { font-size: 2rem; }
        .skill-button .cooldown-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: var(--font-pixel);
            font-size: 1.2rem;
            color: white;
            transition: height 0.1s linear;
        }
        .skill-button:disabled { cursor: not-allowed; filter: grayscale(1); }
        
        .floating-text { position: absolute; font-family: var(--font-pixel); font-size: 1.2rem; user-select: none; pointer-events: none; animation: floatUp 1.2s ease-out forwards; opacity: 0; }
        .floating-text.xp { color: var(--xp-color); animation-delay: 0s; }
        .floating-text.creds { color: var(--gold-color); animation-delay: 0.2s; }
        .floating-text.levelup { font-size: 2rem; color: var(--highlight-color); text-shadow: 0 0 10px var(--highlight-color); animation-duration: 2s; }

        @keyframes floatUp {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-70px); }
        }

        /* --- Painel da Loja e Controles --- */
        .shop-panel { grid-area: shop; }
        .controls-panel { grid-area: controls; }
        
        .shop-tabs { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
        .tab-btn { font-family: var(--font-pixel); font-size: 0.8rem; padding: 0.7rem 1rem; border: 1px solid var(--secondary-color); background: var(--secondary-color); color: var(--accent-color); cursor: pointer; border-radius: 8px 8px 0 0; }
        .tab-btn.active { background: var(--primary-color); color: var(--highlight-color); border-bottom: 1px solid var(--primary-color); }
        
        .shop-content { display: none; }
        .shop-content.active { display: block; }
        
        .shop-list, .controls-buttons { display: flex; flex-direction: column; gap: 1rem; }
        .shop-category h3 { font-family: var(--font-pixel); font-size: 1rem; color: var(--highlight-color); margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .shop-item, .training-item { display: flex; justify-content: space-between; align-items: center; background: var(--secondary-color); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--highlight-color); }
        .item-info .name { font-weight: bold; display: flex; align-items: center; gap: 0.75rem; }
        .item-info .bonus, .item-info .description { font-size: 0.9rem; color: #ccc; }
        
        .btn { font-family: var(--font-pixel); border: none; padding: 0.8rem 1.2rem; border-radius: 6px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; font-size: 0.8rem; }
        .btn-buy { background-color: var(--highlight-color); color: var(--bg-color); }
        .btn-equip { background-color: var(--gold-color); color: var(--bg-color); }
        .btn-skill { background-color: var(--skill-color); color: var(--bg-color); }
        .btn-buy:hover:not(:disabled), .btn-equip:hover:not(:disabled), .btn-skill:hover:not(:disabled) { transform: translateY(-2px); }
        .btn:disabled { background-color: #555; cursor: not-allowed; opacity: 0.7; transform: none; }
        
        .btn-action { background-color: var(--highlight-color); color: var(--bg-color); }
        .btn-danger { background-color: var(--danger-color); color: var(--accent-color); }
        
        /* --- Responsividade --- */
        @media (min-width: 900px) {
            .game-container {
                grid-template-columns: 350px 1fr;
                grid-template-areas:
                    "character action"
                    "character skills"
                    "character shop"
                    "character controls";
                gap: 2rem;
            }
            .character-panel { position: sticky; top: 1rem; height: calc(100vh - 2rem); overflow-y: auto; }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Painel do Personagem (Esquerda) -->
        <div class="panel character-panel">
            <div class="char-header">
                <h1>Mercenário</h1>
                <h2 id="level-display">Level 1</h2>
            </div>
            <div class="equipped-items-display" id="equipped-items-display"></div>
            <div class="xp-bar-container"><div id="xp-bar"></div></div>
            <p id="xp-text">0 / 100 XP</p>
            <div class="resources-display">
                <p id="creds-display"><i class="fas fa-coins"></i> 0</p>
                <p id="skill-points-display"><i class="fas fa-star"></i> 0</p>
            </div>
            <h3 style="margin-top: 2rem; font-size: 1rem;">Atributos</h3>
            <div class="attributes-grid" id="attributes-display"></div>
            <h3 style="margin-top: 2rem; font-size: 1rem;">Estatísticas</h3>
            <div class="stats-grid" id="stats-display"></div>
        </div>

        <!-- Painel de Ação (Centro) -->
        <div class="panel action-panel" id="action-panel">
            <h2 id="enemy-name">Alvo: Drone de Segurança</h2>
            <button id="action-button"><i id="enemy-icon" class="fas fa-crosshairs"></i></button>
        </div>
        
        <!-- Painel de Habilidades Ativas -->
        <div class="panel skills-panel">
            <h2><i class="fas fa-bolt"></i> Habilidades Ativas</h2>
            <div class="skills-bar" id="active-skills-bar">
                <!-- Habilidades ativas inseridas aqui -->
            </div>
        </div>

        <!-- Painel da Loja (Direita) -->
        <div class="panel shop-panel">
            <div class="shop-tabs">
                <button class="tab-btn active" data-tab="equipment">Equipamentos</button>
                <button class="tab-btn" data-tab="training">Treinamento</button>
                <button class="tab-btn" data-tab="skills">Habilidades</button>
            </div>
            <div id="equipment-content" class="shop-content active">
                <h2><i class="fas fa-store"></i> Mercado Negro</h2>
                <div class="shop-list" id="equipment-shop-list"></div>
            </div>
            <div id="training-content" class="shop-content">
                <h2><i class="fas fa-dumbbell"></i> Treinar Atributos</h2>
                <div class="shop-list" id="training-shop-list"></div>
            </div>
            <div id="skills-content" class="shop-content">
                <h2><i class="fas fa-brain"></i> Comprar Habilidades</h2>
                <div class="shop-list" id="skills-shop-list"></div>
            </div>
        </div>
        
        <!-- Painel de Controles -->
        <div class="panel controls-panel">
            <h2><i class="fas fa-cogs"></i> Sistema</h2>
            <div class="controls-buttons">
                <button id="save-button" class="btn btn-action">Salvar Manual</button>
                <button id="reset-button" class="btn btn-danger">Resetar Jogo</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elementos do DOM ---
        const levelDisplay = document.getElementById('level-display'),
              equippedItemsDisplay = document.getElementById('equipped-items-display'),
              xpBar = document.getElementById('xp-bar'),
              xpText = document.getElementById('xp-text'),
              credsDisplay = document.getElementById('creds-display'),
              skillPointsDisplay = document.getElementById('skill-points-display'),
              attributesDisplay = document.getElementById('attributes-display'),
              statsDisplay = document.getElementById('stats-display'),
              actionButton = document.getElementById('action-button'),
              actionPanel = document.getElementById('action-panel'),
              enemyName = document.getElementById('enemy-name'),
              enemyIcon = document.getElementById('enemy-icon'),
              activeSkillsBar = document.getElementById('active-skills-bar'),
              equipmentShopList = document.getElementById('equipment-shop-list'),
              trainingShopList = document.getElementById('training-shop-list'),
              skillsShopList = document.getElementById('skills-shop-list'),
              shopTabs = document.querySelectorAll('.tab-btn'),
              saveButton = document.getElementById('save-button'),
              resetButton = document.getElementById('reset-button');

        // --- Dados do Jogo ---
        const equipmentData = {
            arma: [ { id: 'w1', name: 'Pistola Básica', cost: 50, icon: 'fa-gun', bonus: { stat: 'attack', value: 2 } }, { id: 'w2', name: 'Submetralhadora', cost: 250, icon: 'fa-dragon', bonus: { stat: 'attack', value: 10 } }, { id: 'w3', name: 'Rifle de Precisão', cost: 1200, icon: 'fa-bullseye', bonus: { stat: 'attack', value: 40 } }, ],
            armadura: [ { id: 'a1', name: 'Jaqueta Reforçada', cost: 75, icon: 'fa-shirt', bonus: { stat: 'defense', value: 5 } }, { id: 'a2', name: 'Colete de Kevlar', cost: 300, icon: 'fa-user-shield', bonus: { stat: 'defense', value: 20 } }, { id: 'a3', name: 'Placas de Titânio', cost: 1500, icon: 'fa-shield-halved', bonus: { stat: 'defense', value: 80 } }, ],
            implante: [ { id: 'i1', name: 'Olho Cibernético', cost: 500, icon: 'fa-eye', bonus: { stat: 'destreza', value: 5 } }, { id: 'i2', name: 'Braço Hidráulico', cost: 800, icon: 'fa-robot', bonus: { stat: 'forca', value: 8 } }, ]
        };
        const enemyData = [ { level: 1, name: 'Drone de Segurança', icon: 'fa-crosshairs', color: '#f04a4a' }, { level: 5, name: 'Guarda Corporativo', icon: 'fa-user-shield', color: '#f0a04a' }, { level: 10, name: 'Mecha de Patrulha', icon: 'fa-robot', color: '#e0e0e0' }, { level: 20, name: 'Netrunner Inimigo', icon: 'fa-user-secret', color: '#ff00ff' }, ];
        const skillsData = {
            passive: [
                { id: 'p1', name: 'Protocolo de Eficiência', maxLevel: 5, cost: 1, description: 'Aumenta o ganho de XP em 5% por nível.', bonus: { stat: 'xpMultiplier', value: 0.05 } },
                { id: 'p2', name: 'Conexão Neural', maxLevel: 5, cost: 1, description: 'Aumenta a chance de drop de créditos em 2% por nível.', bonus: { stat: 'critCredChance', value: 0.02 } }
            ],
            active: [
                { id: 'ac1', name: 'Overdrive', cost: 2500, icon: 'fa-bolt', description: 'Aumenta o dano do clique em 200% por 10s.', cooldown: 60, duration: 10, effect: { type: 'multiplier', stat: 'clickDamage', value: 2 } },
                { id: 'ac2', name: 'Hack de Créditos', cost: 5000, icon: 'fa-sack-dollar', description: 'Gera instantaneamente 30s de ganhos.', cooldown: 120, effect: { type: 'instant', stat: 'creds', value: 30 } }
            ]
        };

        // --- Estado do Jogo (Padrão) ---
        const defaultGameState = {
            level: 1, xp: 0, xpToNextLevel: 100, creds: 0, skillPoints: 0,
            attributes: { forca: 1, destreza: 1, vigor: 1 },
            equipment: { arma: null, armadura: null, implante: null },
            inventory: { arma: [], armadura: [], implante: [] },
            skills: { passive: {}, active: {} }, // { p1: level, ac1: purchased }
            activeEffects: {}, // { overdrive: { expiry: timestamp } }
            skillCooldowns: {}, // { ac1: timestamp }
            stats: { attack: 0, defense: 0, credsPerClick: 0, xpMultiplier: 1, critCredChance: 0 }
        };
        let gameState = JSON.parse(JSON.stringify(defaultGameState));
        
        // --- Lógica Principal ---
        function calculateStats() {
            const base = gameState.attributes;
            const eqIds = gameState.equipment;
            
            // Reset multipliers
            gameState.stats.xpMultiplier = 1 + ( (gameState.skills.passive.p1 || 0) * skillsData.passive[0].bonus.value );
            gameState.stats.critCredChance = (gameState.skills.passive.p2 || 0) * skillsData.passive[1].bonus.value;
            
            const equippedImplante = findItem('implante', eqIds.implante);
            let currentForca = base.forca + (equippedImplante?.bonus.stat === 'forca' ? equippedImplante.bonus.value : 0);
            let currentDestreza = base.destreza + (equippedImplante?.bonus.stat === 'destreza' ? equippedImplante.bonus.value : 0);
            
            let totalAttack = currentForca * 2 + currentDestreza;
            let totalDefense = base.vigor * 3;

            const equippedArma = findItem('arma', eqIds.arma);
            if (equippedArma) totalAttack += equippedArma.bonus.value;
            const equippedArmadura = findItem('armadura', eqIds.armadura);
            if (equippedArmadura) totalDefense += equippedArmadura.bonus.value;
            
            gameState.stats.attack = totalAttack;
            gameState.stats.defense = totalDefense;
            gameState.stats.credsPerClick = Math.floor(1 + totalAttack / 5);
        }

        function manualClick(event) {
            let clickDamageMultiplier = 1;
            if (gameState.activeEffects.overdrive) {
                clickDamageMultiplier += skillsData.active[0].effect.value;
            }

            const xpGained = Math.max(1, Math.floor( (gameState.stats.attack * clickDamageMultiplier) / 2)) * gameState.stats.xpMultiplier;
            let credsGained = gameState.stats.credsPerClick;
            if (Math.random() < gameState.stats.critCredChance) {
                credsGained *= 2; // Dobro de créditos no crítico
            }

            gameState.xp += xpGained;
            gameState.creds += credsGained;
            showFloatingText(`+${Math.floor(xpGained)} XP`, event, 'xp');
            showFloatingText(`+${credsGained} Creds`, event, 'creds');
            if (gameState.xp >= gameState.xpToNextLevel) levelUp();
            updateUI();
        }
        
        function levelUp() {
            gameState.level++;
            gameState.xp -= gameState.xpToNextLevel;
            gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
            if (gameState.level % 5 === 0) {
                gameState.skillPoints++;
            }
            showFloatingText(`LEVEL UP!`, { clientX: window.innerWidth / 2, clientY: window.innerHeight / 3 }, 'levelup');
            updateEnemy();
        }

        window.buyEquipment = (type, id) => {
            const item = findItem(type, id);
            if (item && gameState.creds >= item.cost && !gameState.inventory[type].includes(id)) {
                gameState.creds -= item.cost;
                gameState.inventory[type].push(id);
                updateUI();
            }
        };

        window.equipItem = (type, id) => {
            if (gameState.inventory[type].includes(id)) {
                gameState.equipment[type] = id;
                calculateStats();
                updateUI();
            }
        };

        window.trainAttribute = (attr) => {
            const cost = 10 * Math.pow(1.2, gameState.attributes[attr]);
            if (gameState.creds >= cost) {
                gameState.creds -= cost;
                gameState.attributes[attr]++;
                calculateStats();
                updateUI();
            }
        };

        window.buySkill = (type, id) => {
            if (type === 'passive') {
                const skill = skillsData.passive.find(s => s.id === id);
                const currentLevel = gameState.skills.passive[id] || 0;
                if (skill && gameState.skillPoints >= skill.cost && currentLevel < skill.maxLevel) {
                    gameState.skillPoints -= skill.cost;
                    gameState.skills.passive[id] = currentLevel + 1;
                }
            } else { // active
                const skill = skillsData.active.find(s => s.id === id);
                if (skill && gameState.creds >= skill.cost && !gameState.skills.active[id]) {
                    gameState.creds -= skill.cost;
                    gameState.skills.active[id] = true;
                }
            }
            calculateStats();
            updateUI();
        };
        
        window.activateSkill = (id) => {
            const skill = skillsData.active.find(s => s.id === id);
            if (!skill || gameState.skillCooldowns[id] > Date.now()) return;

            gameState.skillCooldowns[id] = Date.now() + skill.cooldown * 1000;

            if (skill.effect.type === 'multiplier') {
                gameState.activeEffects.overdrive = { expiry: Date.now() + skill.duration * 1000 };
            } else if (skill.effect.type === 'instant') {
                const credsFromHack = gameState.stats.credsPerClick * skill.effect.value;
                gameState.creds += credsFromHack;
            }
            updateUI();
        };

        function findItem(type, id) {
            if (!id || !type) return null;
            return equipmentData[type].find(i => i.id === id);
        }

        function gameLoop() {
            // Check for expired effects
            if (gameState.activeEffects.overdrive && gameState.activeEffects.overdrive.expiry < Date.now()) {
                delete gameState.activeEffects.overdrive;
            }
            // Update cooldown displays
            renderActiveSkills();
        }

        // --- Funções de UI ---
        function updateUI() {
            levelDisplay.textContent = `Level ${gameState.level}`;
            xpText.textContent = `${Math.floor(gameState.xp)} / ${gameState.xpToNextLevel} XP`;
            xpBar.style.width = `${(gameState.xp / gameState.xpToNextLevel) * 100}%`;
            credsDisplay.innerHTML = `<i class="fas fa-coins"></i> ${Math.floor(gameState.creds)}`;
            skillPointsDisplay.innerHTML = `<i class="fas fa-star"></i> ${gameState.skillPoints}`;
            attributesDisplay.innerHTML = Object.keys(gameState.attributes).map(key => `<div class="attribute-item"><div class="label">${key.charAt(0).toUpperCase() + key.slice(1)}</div><div class="value">${gameState.attributes[key]}</div></div>`).join('');
            statsDisplay.innerHTML = `<div class="stat-item"><div class="label">Ataque</div><div class="value">${gameState.stats.attack}</div></div><div class="stat-item"><div class="label">Defesa</div><div class="value">${gameState.stats.defense}</div></div><div class="stat-item"><div class="label">Creds/Ataque</div><div class="value">${gameState.stats.credsPerClick}</div></div>`;
            renderEquippedItems();
            renderShops();
            renderActiveSkills();
        }

        function renderEquippedItems() {
            equippedItemsDisplay.innerHTML = Object.keys(gameState.equipment).map(type => {
                const itemId = gameState.equipment[type];
                const item = findItem(type, itemId);
                const icon = item ? item.icon : `fa-question`;
                return `<div class="equipped-slot" title="${item ? item.name : 'Vazio'}"><i class="fa-solid ${icon}"></i></div>`;
            }).join('');
        }

        function updateEnemy() {
            const currentEnemy = [...enemyData].reverse().find(e => gameState.level >= e.level) || enemyData[0];
            enemyName.textContent = `Alvo: ${currentEnemy.name}`;
            enemyIcon.className = `fas ${currentEnemy.icon}`;
            enemyIcon.style.color = currentEnemy.color;
            enemyIcon.style.filter = `drop-shadow(0 0 15px ${currentEnemy.color})`;
        }

        function renderShops() {
            equipmentShopList.innerHTML = Object.keys(equipmentData).map(type => {
                let categoryHtml = `<div class="shop-category"><h3>${type.charAt(0).toUpperCase() + type.slice(1)}s</h3>`;
                categoryHtml += equipmentData[type].map(item => {
                    const isOwned = gameState.inventory[type].includes(item.id);
                    const isEquipped = gameState.equipment[type] === item.id;
                    const canAfford = gameState.creds >= item.cost;
                    
                    let buttonHtml = '';
                    if (isEquipped) {
                        buttonHtml = `<button class="btn" disabled>Equipado</button>`;
                    } else if (isOwned) {
                        buttonHtml = `<button class="btn btn-equip" onclick="equipItem('${type}', '${item.id}')">Equipar</button>`;
                    } else {
                        buttonHtml = `<button class="btn btn-buy" onclick="buyEquipment('${type}', '${item.id}')" ${!canAfford ? 'disabled' : ''}>${Math.floor(item.cost)} Creds</button>`;
                    }
                    let bonusText = '';
                    if (item.bonus.stat === 'attack' || item.bonus.stat === 'defense') {
                        bonusText = `+${item.bonus.value} ${item.bonus.stat}`;
                    } else {
                        bonusText = `+${item.bonus.value} ${item.bonus.stat.charAt(0).toUpperCase() + item.bonus.stat.slice(1)}`;
                    }
                    return `<div class="shop-item"><div class="item-info"><div class="name"><i class="fa-solid ${item.icon}"></i> ${item.name}</div><div class="bonus">${bonusText}</div></div>${buttonHtml}</div>`;
                }).join('');
                return categoryHtml + `</div>`;
            }).join('');
            
            trainingShopList.innerHTML = Object.keys(gameState.attributes).map(attr => {
                 const cost = 10 * Math.pow(1.2, gameState.attributes[attr]);
                 const canAfford = gameState.creds >= cost;
                 return `<div class="training-item"><div class="item-info"><div class="name">Treinar ${attr.charAt(0).toUpperCase() + attr.slice(1)}</div></div><button class="btn btn-buy" onclick="trainAttribute('${attr}')" ${!canAfford ? 'disabled' : ''}>${Math.floor(cost)} Creds</button></div>`;
            }).join('');

            skillsShopList.innerHTML = '';
            skillsData.passive.forEach(skill => {
                const currentLevel = gameState.skills.passive[skill.id] || 0;
                const canAfford = gameState.skillPoints >= skill.cost;
                const isMaxed = currentLevel >= skill.maxLevel;
                skillsShopList.innerHTML += `<div class="shop-item"><div class="item-info"><div class="name"><i class="fa-solid fa-star"></i> ${skill.name} (${currentLevel}/${skill.maxLevel})</div><div class="description">${skill.description}</div></div><button class="btn btn-skill" onclick="buySkill('passive', '${skill.id}')" ${!canAfford || isMaxed ? 'disabled' : ''}>${isMaxed ? 'MAX' : `${skill.cost} PH`}</button></div>`;
            });
            skillsData.active.forEach(skill => {
                const isOwned = gameState.skills.active[skill.id];
                const canAfford = gameState.creds >= skill.cost;
                if (!isOwned) {
                    skillsShopList.innerHTML += `<div class="shop-item"><div class="item-info"><div class="name"><i class="fa-solid ${skill.icon}"></i> ${skill.name}</div><div class="description">${skill.description}</div></div><button class="btn btn-buy" onclick="buySkill('active', '${skill.id}')" ${!canAfford ? 'disabled' : ''}>${skill.cost} Creds</button></div>`;
                }
            });
        }
        
        function renderActiveSkills() {
            activeSkillsBar.innerHTML = '';
            Object.keys(gameState.skills.active).forEach(id => {
                if (gameState.skills.active[id]) {
                    const skill = skillsData.active.find(s => s.id === id);
                    const cooldownLeft = Math.ceil((gameState.skillCooldowns[id] - Date.now()) / 1000);
                    const onCooldown = cooldownLeft > 0;
                    const button = document.createElement('button');
                    button.className = 'skill-button';
                    button.disabled = onCooldown;
                    button.title = `${skill.name}\n${skill.description}`;
                    button.onclick = () => activateSkill(id);
                    button.innerHTML = `<i class="fa-solid ${skill.icon}"></i>`;
                    if (onCooldown) {
                        const overlay = document.createElement('div');
                        overlay.className = 'cooldown-overlay';
                        overlay.textContent = cooldownLeft;
                        button.appendChild(overlay);
                    }
                    activeSkillsBar.appendChild(button);
                }
            });
        }

        function showFloatingText(text, event, type) {
            const el = document.createElement('div');
            el.className = `floating-text ${type}`;
            el.textContent = text;
            const rect = actionPanel.getBoundingClientRect();
            el.style.left = `${event.clientX - rect.left}px`;
            el.style.top = `${event.clientY - rect.top}px`;
            actionPanel.appendChild(el);
            setTimeout(() => el.remove(), type === 'levelup' ? 2000 : 1200);
        }

        function switchTab(tabName) {
            shopTabs.forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab-btn[data-tab="${tabName}"]`).classList.add('active');
            document.querySelectorAll('.shop-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        // --- Save, Load & Reset ---
        const SAVE_KEY = 'cyberpunkRPGSave';
        function saveGame() {
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
            saveButton.textContent = 'Salvo!';
            setTimeout(() => saveButton.textContent = 'Salvar Manual', 2000);
        }
        function loadGame() {
            const savedData = localStorage.getItem(SAVE_KEY);
            if (savedData) {
                const loadedState = JSON.parse(savedData);
                const freshState = JSON.parse(JSON.stringify(defaultGameState));
                Object.assign(freshState, loadedState);
                freshState.attributes = { ...defaultGameState.attributes, ...(loadedState.attributes || {}) };
                freshState.equipment = { ...defaultGameState.equipment, ...(loadedState.equipment || {}) };
                freshState.inventory = { ...defaultGameState.inventory, ...(loadedState.inventory || {}) };
                freshState.stats = { ...defaultGameState.stats, ...(loadedState.stats || {}) };
                freshState.skills = { passive: {...(loadedState.skills?.passive || {})}, active: {...(loadedState.skills?.active || {})} };
                freshState.skillCooldowns = loadedState.skillCooldowns || {};
                freshState.activeEffects = loadedState.activeEffects || {};
                gameState = freshState;
            }
        }
        function resetGame() {
            if (confirm("Você tem certeza que quer resetar todo o progresso? Essa ação não pode ser desfeita.")) {
                localStorage.removeItem(SAVE_KEY);
                gameState = JSON.parse(JSON.stringify(defaultGameState));
                window.location.reload();
            }
        }

        // --- Dev Tools / Test Environment ---
        const dev = {
            help: () => { console.log("%c--- Comandos de Desenvolvedor ---\ndev.addCreds(valor)\ndev.addXp(valor)\ndev.setLevel(nivel)\ndev.setAttribute('forca'|'destreza'|'vigor', valor)\ndev.addSkillPoints(valor)\ndev.reset()\ndev.runTests() // Roda a suíte de testes\n---------------------------------", "color: #00ffff; font-family: monospace;"); },
            addCreds: (amount=1000) => { gameState.creds += amount; updateUI(); },
            addXp: (amount=100) => { gameState.xp += amount; updateUI(); },
            setLevel: (level=1) => { gameState.level = level; gameState.xp = 0; gameState.xpToNextLevel = 100 * Math.pow(1.5, level - 1); updateEnemy(); updateUI(); },
            setAttribute: (attr, value) => { if (gameState.attributes.hasOwnProperty(attr)) { gameState.attributes[attr] = value; calculateStats(); updateUI(); } else { console.error("Atributo inválido."); } },
            addSkillPoints: (amount=1) => { gameState.skillPoints += amount; updateUI(); },
            reset: resetGame,
            runTests: () => {
                console.log("%c--- INICIANDO TESTES AUTOMATIZADOS ---", "color: #ffd700; font-size: 1.2em;");
                let passed = 0; let failed = 0;
                const test = (description, testFn) => {
                    const originalState = JSON.parse(JSON.stringify(gameState));
                    try { testFn(); console.log(`%c[PASSOU] ${description}`, "color: #39ff14;"); passed++; } catch (e) { console.error(`%c[FALHOU] ${description}`, "color: #f04a4a;"); console.error(e); failed++; }
                    gameState = originalState; calculateStats(); updateUI();
                };

                test("Ganhar Ponto de Habilidade no nível 5", () => {
                    dev.setLevel(4);
                    levelUp();
                    if (gameState.skillPoints !== 1) throw new Error(`Esperado 1 PH, mas foi: ${gameState.skillPoints}`);
                });
                test("Comprar habilidade passiva aumenta multiplicador de XP", () => {
                    const initialXpMult = gameState.stats.xpMultiplier;
                    dev.addSkillPoints(1);
                    buySkill('passive', 'p1');
                    const expectedMult = initialXpMult + skillsData.passive[0].bonus.value;
                    if (gameState.stats.xpMultiplier.toFixed(2) !== expectedMult.toFixed(2)) throw new Error(`Multiplicador de XP esperado: ${expectedMult}, mas foi: ${gameState.stats.xpMultiplier}`);
                });
                test("Habilidade ativa 'Overdrive' entra em cooldown", () => {
                    dev.addCreds(2500);
                    buySkill('active', 'ac1');
                    activateSkill('ac1');
                    if (!gameState.skillCooldowns['ac1']) throw new Error("Cooldown não foi iniciado para Overdrive.");
                });
                
                console.log(`%c--- RESULTADO DOS TESTES: ${passed} passaram, ${failed} falharam. ---`, "color: #ffd700; font-size: 1.2em;");
            }
        };
        window.dev = dev;

        // --- Inicialização e Bindings ---
        loadGame();
        calculateStats();
        updateEnemy();
        updateUI();
        setInterval(gameLoop, 1000); // Game loop para cooldowns
        console.log("Ambiente de teste carregado. Digite 'dev.help()' ou 'dev.runTests()' no console.");
        
        actionButton.addEventListener('click', manualClick);
        shopTabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));
        saveButton.addEventListener('click', saveGame);
        resetButton.addEventListener('click', resetGame);
        setInterval(saveGame, 30000); // Autosave
    });
    </script>
</body>
</html>
